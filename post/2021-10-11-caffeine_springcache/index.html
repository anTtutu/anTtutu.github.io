<!doctype html>
<html lang="zh-CN">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="referrer" content="no-referrer-when-downgrade">
    

    <title>caffeine和springcache | Anttu&#39;s Blog</title>
    <meta property="og:title" content="caffeine和springcache - Anttu&#39;s Blog">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content='2021-10-11T00:29:47&#43;08:00'>
        
        
    <meta property="article:modified_time" content='2021-10-11T00:29:47&#43;08:00'>
        
    <meta name="Keywords" content="golang,go语言,go语言笔记,anttu,java,博客,bash,linux笔记,python笔记,公众号,小程序">
    <meta name="description" content="caffeine和springcache">
        
    <meta name="author" content="Anttu">
    <meta property="og:url" content="https://anTtutu.github.io/post/2021-10-11-caffeine_springcache/">
    <link rel="shortcut icon" href='/favicon.ico'  type="image/x-icon">

    <link rel="stylesheet" href='/css/normalize.css'>
    <link rel="stylesheet" href='/css/style.css'>
    <script type="text/javascript" src="//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    
    
    
    
    
    
        <link rel="stylesheet" href='/css/asciinema-player.css'>
    
</head>


<body>
    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="https://anTtutu.github.io/">
                        Anttu&#39;s Blog
                    </a>
                
                <p class="description">一位Java开发者，喜欢研究技术，同时也在学习Golang和Python中，对服务器、Linux使用比较熟悉。欢迎添加技术交流QQ群：655158296</p>
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="current" href="https://anTtutu.github.io/">首页</a>
                    
                    <a  href="https://anTtutu.github.io/archives/" title="归档">归档</a>
                    
                    <a  href="https://anTtutu.github.io/tags/" title="分类">分类</a>
                    
                    <a  href="https://anTtutu.github.io/about/" title="关于">关于</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>

    <div id="body">
        <div class="container">
            <div class="col-group">

                <div class="col-8" id="main">
                    
<div class="res-cons">
    <style type="text/css">
    .post-toc {
        position: fixed;
        width: 200px;
        margin-left: -210px;
        padding: 5px 10px;
        font-family: Athelas, STHeiti, Microsoft Yahei, serif;
        font-size: 12px;
        border: 1px solid rgba(0, 0, 0, .07);
        border-radius: 5px;
        background-color: rgba(255, 255, 255, 0.98);
        background-clip: padding-box;
        -webkit-box-shadow: 1px 1px 2px rgba(0, 0, 0, .125);
        box-shadow: 1px 1px 2px rgba(0, 0, 0, .125);
        word-wrap: break-word;
        white-space: nowrap;
        -webkit-box-sizing: border-box;
        box-sizing: border-box;
        z-index: 999;
        cursor: pointer;
        max-height: 70%;
        overflow-y: auto;
        overflow-x: hidden;
    }

    .post-toc .post-toc-title {
        width: 100%;
        margin: 0 auto;
        font-size: 20px;
        font-weight: 400;
        text-transform: uppercase;
        text-align: center;
    }

    .post-toc .post-toc-content {
        font-size: 15px;
    }

    .post-toc .post-toc-content>nav>ul {
        margin: 10px 0;
    }

    .post-toc .post-toc-content ul {
        padding-left: 20px;
        list-style: square;
        margin: 0.5em;
        line-height: 1.8em;
    }

    .post-toc .post-toc-content ul ul {
        padding-left: 15px;
        display: none;
    }

    @media print,
    screen and (max-width:1057px) {
        .post-toc {
            display: none;
        }
    }
</style>
<div class="post-toc" style="position: absolute; top: 188px;">
    <h2 class="post-toc-title">文章目录</h2>
    <div class="post-toc-content">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#前言">前言</a>
      <ul>
        <li><a href="#缓存">缓存</a></li>
        <li><a href="#淘汰算法特点">淘汰算法特点</a></li>
        <li><a href="#局限性">局限性</a></li>
        <li><a href="#结论">结论</a></li>
      </ul>
    </li>
    <li><a href="#1参数介绍">1、参数介绍</a>
      <ul>
        <li><a href="#11-guava">1.1 guava</a></li>
        <li><a href="#12-caffeine">1.2 caffeine</a></li>
      </ul>
    </li>
    <li><a href="#2使用注解来对cache增删改查">2、使用注解来对cache增删改查</a>
      <ul>
        <li><a href="#21-cache方面的注解主要有以下5个">2.1 cache方面的注解主要有以下5个：</a></li>
      </ul>
    </li>
    <li><a href="#3springboot中默认的缓存">3、springboot中默认的缓存</a></li>
    <li><a href="#4springboot中使用caffeine">4、springboot中使用caffeine</a>
      <ul>
        <li><a href="#41-pom中配置依赖">4.1 pom中配置依赖</a></li>
        <li><a href="#42-配置文件注入相关参数">4.2 配置文件注入相关参数</a></li>
        <li><a href="#43-注解开启缓存支持">4.3 注解开启缓存支持</a></li>
        <li><a href="#44-cache-config实现">4.4 cache config实现</a></li>
      </ul>
    </li>
    <li><a href="#5缓存统计">5、缓存统计</a></li>
    <li><a href="#6缓存填充策略">6、缓存填充策略</a>
      <ul>
        <li><a href="#61-手动加载">6.1 手动加载</a></li>
        <li><a href="#62-同步加载">6.2 同步加载</a></li>
        <li><a href="#63-异步加载">6.3. 异步加载</a></li>
      </ul>
    </li>
    <li><a href="#7缓存回收策略">7、缓存回收策略</a>
      <ul>
        <li><a href="#71-基于大小的过期方式">7.1 基于大小的过期方式</a></li>
        <li><a href="#72-基于时间的过期方式">7.2 基于时间的过期方式</a></li>
        <li><a href="#73-基于引用的过期方式">7.3 基于引用的过期方式</a></li>
      </ul>
    </li>
    <li><a href="#8参考和引用">8、参考和引用</a></li>
  </ul>
</nav>
    </div>
</div>
<script type="text/javascript">
    $(document).ready(function () {
        var postToc = $(".post-toc");
        if (postToc.length) {
            var leftPos = $("#main").offset().left;
            if(leftPos<220){
                postToc.css({"width":leftPos-10,"margin-left":(0-leftPos)})
            }

            var t = postToc.offset().top - 20,
                a = {
                    start: {
                        position: "absolute",
                        top: t
                    },
                    process: {
                        position: "fixed",
                        top: 20
                    },
                };
            $(window).scroll(function () {
                var e = $(window).scrollTop();
                e < t ? postToc.css(a.start) : postToc.css(a.process)
            })
        }
    })
</script>
    <article class="post">
        <header>
            <h1 class="post-title">caffeine和springcache</h1>
        </header>
        <date class="post-meta meta-date">
            2021年10月11日
        </date>
        
        <div class="post-meta">
            <span>|</span>
            
            <span class="meta-category"><a href='/categories/caffeine'>caffeine</a></span>
            
            <span class="meta-category"><a href='/categories/java'>java</a></span>
            
            <span class="meta-category"><a href='/categories/cache'>cache</a></span>
            
        </div>
        
        
        <div class="post-meta">
            <span id="busuanzi_container_page_pv">|<span id="busuanzi_value_page_pv"></span><span>
                    阅读</span></span>
        </div>
        
        
        <div class="clear" style="display: none">
            <div class="toc-article">
                <div class="toc-title">文章目录</div>
            </div>
        </div>
        
        <div class="post-content">
            <h2 id="前言">前言</h2>
<p>说到caffeine，一般会对比 google 家的 guava，这里只做浅析。</p>
<h3 id="缓存">缓存</h3>
<p>缓存分为本地缓存和远端缓存。<br>
常见的远端缓存有Redis，MongoDB；<br>
本地缓存一般使用map的方式保存在本地内存中。</p>
<p>一般我们在业务中操作缓存，都会操作缓存和数据源两部分。<br>
如：put数据时，先插入DB，再删除原来的缓存；get数据时，先查缓存，命中则返回，没有命中时，需要查询DB，再把查询结果放入缓存中。<br>
如果访问量大，我们还得兼顾本地缓存的线程安全问题。<br>
必要的时候也要考虑缓存的回收策略。</p>
<h4 id="guava">Guava</h4>
<p>Guava Cache 是google guava中的一个内存缓存模块，用于将数据缓存到JVM内存中。他很好的解决了上面提到的几个问题。</p>
<ul>
<li>很好的封装了get、put操作，能够集成数据源；</li>
<li>线程安全的缓存，与ConcurrentMap相似，但前者增加了更多的元素失效策略，后者只能显示的移除元素；</li>
<li>Guava Cache提供了三种基本的缓存回收方式：<br>
基于容量回收、定时回收和基于引用回收。<br>
定时回收有两种：按照写入时间，最早写入的最先回收；<br>
按照访问时间，最早访问的最早回收；</li>
<li>监控缓存加载/命中情况</li>
</ul>
<p>Guava Cache的架构设计灵感ConcurrentHashMap，在简单场景中可以通过HashMap实现简单数据缓存，但如果要实现缓存随时间改变、存储的数据空间可控则缓存工具还是很有必要的。<br>
Cache存储的是键值对的集合，不同时是还需要处理缓存过期、动态加载等算法逻辑，需要额外信息实现这些操作，对此根据面向对象的思想，还需要做方法与数据的关联性封装，主要实现的缓存功能有：</p>
<ul>
<li>自动将节点加载至缓存结构中，当缓存的数据超过最大值时，使用LRU算法替换；</li>
<li>它具备根据节点上一次被访问或写入时间计算缓存过期机制，缓存的key被封装在WeakReference引用中，缓存的value被封装在WeakReference或SoftReference引用中；</li>
<li>还可以统计缓存使用过程中的命中率、异常率和命中率等统计数据。</li>
<li>当缓存的数据超过最大值时，使用LRU算法替换。</li>
</ul>
<h4 id="caffeine">Caffeine</h4>
<p>Caffeine Cache它也是站在巨人的肩膀上-Guava Cache，借着他的思想优化了算法发展而来</p>
<p>说到优化，Caffeine Cache到底优化了什么呢？Caffeine 因使用 Window TinyLfu 回收策略，提供了一个近乎最佳的命中率。</p>
<h3 id="淘汰算法特点">淘汰算法特点</h3>
<p>刚提到guava基于LRU封装，常见的缓存淘汰算法还有FIFO，LFU。</p>
<h4 id="fifo">FIFO：</h4>
<p>先进先出，在这种淘汰算法中，先进入缓存的会先被淘汰，会导致命中率很低。</p>
<h4 id="lru">LRU：</h4>
<p>最近最少使用算法，每次访问数据都会将其放在我们的队尾，如果需要淘汰数据，就只需要淘汰队首即可。仍然有个问题，如果有个数据在 1 分钟访问了 1000次，再后 1 分钟没有访问这个数据，但是有其他的数据访问，就导致了我们这个热点数据被淘汰。</p>
<h4 id="lfu">LFU：</h4>
<p>最近最少频率使用，利用额外的空间记录每个数据的使用频率，然后选出频率最低进行淘汰。这样就避免了 LRU 不能处理时间段的问题。</p>
<p>上面三种策略各有利弊，实现的成本也是一个比一个高，同时命中率也是一个比一个好。Guava Cache虽然有这么多的功能，但是本质上还是对LRU的封装，如果有更优良的算法，并且也能提供这么多功能，相比之下就相形见绌了。</p>
<h3 id="局限性">局限性</h3>
<h4 id="lfu的局限性">LFU的局限性：</h4>
<p>在 LFU 中只要数据访问模式的概率分布随时间保持不变时，其命中率就能变得非常高。<br>
比如有部新剧出来了，我们使用 LFU 给他缓存下来，这部新剧在这几天大概访问了几亿次，这个访问频率也在我们的 LFU 中记录了几亿次。<br>
但是新剧总会过气的，比如一个月之后这个新剧的前几集其实已经过气了，但是他的访问量的确是太高了，其他的电视剧根本无法淘汰这个新剧，所以在这种模式下是有局限性。</p>
<h4 id="lru的优点和局限性">LRU的优点和局限性：</h4>
<p>LRU可以很好的应对突发流量的情况，因为他不需要累计数据频率。但LRU通过历史数据来预测未来是局限的，它会认为最后到来的数据是最可能被再次访问的，从而给与它最高的优先级。</p>
<h3 id="结论">结论</h3>
<p>在现有算法的局限性下，会导致缓存数据的命中率或多或少的受损，而命中率又是缓存的重要指标。<br>
HighScalability网站刊登了一篇文章，由前Google工程师发明的W-TinyLFU——一种现代的缓存。<br>
Caffeine Cache就是基于此算法而研发。<br>
Caffeine 因使用 Window TinyLfu 回收策略，提供了一个近乎最佳的命中率。</p>
<h2 id="1参数介绍">1、参数介绍</h2>
<h3 id="11-guava">1.1 guava</h3>
<p>guava常见参数解读：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">LoadingCache<span style="color:#000;font-weight:bold">&lt;</span>Object<span style="color:#000;font-weight:bold">,</span> Object<span style="color:#000;font-weight:bold">&gt;</span> userCache <span style="color:#000;font-weight:bold">=</span> CacheBuilder<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">newBuilder</span><span style="color:#000;font-weight:bold">()</span>
         <span style="color:#998;font-style:italic">// 基于容量回收。缓存的最大数量。超过就取MAXIMUM_CAPACITY = 1 &lt;&lt; 30。依靠LRU队列recencyQueue来进行容量淘汰
</span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">maximumSize</span><span style="color:#000;font-weight:bold">(</span>1000<span style="color:#000;font-weight:bold">)</span>
         <span style="color:#998;font-style:italic">// 基于容量回收。但这是统计占用内存大小，maximumWeight与maximumSize不能同时使用。设置最大总权重
</span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">maximumWeight</span><span style="color:#000;font-weight:bold">(</span>1000<span style="color:#000;font-weight:bold">)</span>
         <span style="color:#998;font-style:italic">// 设置权重（可当成每个缓存占用的大小）
</span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">weigher</span><span style="color:#000;font-weight:bold">((</span>o<span style="color:#000;font-weight:bold">,</span> o2<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">-&gt;</span> 5<span style="color:#000;font-weight:bold">)</span>
         <span style="color:#998;font-style:italic">// 软弱引用（引用强度顺序：强软弱虚）
</span><span style="color:#998;font-style:italic"></span>         <span style="color:#998;font-style:italic">// -- 弱引用key
</span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">weakKeys</span><span style="color:#000;font-weight:bold">()</span>
         <span style="color:#998;font-style:italic">// -- 弱引用value
</span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">weakValues</span><span style="color:#000;font-weight:bold">()</span>
         <span style="color:#998;font-style:italic">// -- 软引用value
</span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">softValues</span><span style="color:#000;font-weight:bold">()</span>
         <span style="color:#998;font-style:italic">// 过期失效回收
</span><span style="color:#998;font-style:italic"></span>         <span style="color:#998;font-style:italic">// -- 没读写访问下，超过5秒会失效(非自动失效，需有任意getput方法才会扫描过期失效数据)
</span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">expireAfterAccess</span><span style="color:#000;font-weight:bold">(</span>5L<span style="color:#000;font-weight:bold">,</span> TimeUnit<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">SECONDS</span><span style="color:#000;font-weight:bold">)</span>
         <span style="color:#998;font-style:italic">// -- 没写访问下，超过5秒会失效(非自动失效，需有任意putget方法才会扫描过期失效数据)
</span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">expireAfterWrite</span><span style="color:#000;font-weight:bold">(</span>5L<span style="color:#000;font-weight:bold">,</span> TimeUnit<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">SECONDS</span><span style="color:#000;font-weight:bold">)</span>
         <span style="color:#998;font-style:italic">// 没写访问下，超过5秒会失效(非自动失效，需有任意putget方法才会扫描过期失效数据。但区别是会开一个异步线程进行刷新，刷新过程中访问返回旧数据)
</span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">refreshAfterWrite</span><span style="color:#000;font-weight:bold">(</span>5L<span style="color:#000;font-weight:bold">,</span> TimeUnit<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">SECONDS</span><span style="color:#000;font-weight:bold">)</span>
         <span style="color:#998;font-style:italic">// 移除监听事件
</span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">removalListener</span><span style="color:#000;font-weight:bold">(</span>removal <span style="color:#000;font-weight:bold">-&gt;</span> <span style="color:#000;font-weight:bold">{</span>
             <span style="color:#998;font-style:italic">// 可做一些删除后动作，比如上报删除数据用于统计
</span><span style="color:#998;font-style:italic"></span>             System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;触发删除动作，删除的key=%s%n&#34;</span><span style="color:#000;font-weight:bold">,</span> removal<span style="color:#000;font-weight:bold">);</span>
        <span style="color:#000;font-weight:bold">})</span>
         <span style="color:#998;font-style:italic">// 并行等级。决定segment数量的参数，concurrencyLevel与maxWeight共同决定
</span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">concurrencyLevel</span><span style="color:#000;font-weight:bold">(</span>16<span style="color:#000;font-weight:bold">)</span>
         <span style="color:#998;font-style:italic">// 开启缓存统计。比如命中次数、未命中次数等
</span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">recordStats</span><span style="color:#000;font-weight:bold">()</span>
         <span style="color:#998;font-style:italic">// 所有segment的初始总容量大小
</span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">initialCapacity</span><span style="color:#000;font-weight:bold">(</span>512<span style="color:#000;font-weight:bold">)</span>
         <span style="color:#998;font-style:italic">// 用于测试，可任意改变当前时间。参考：https://www.geek-share.com/detail/2689756248.html
</span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">ticker</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">new</span> Ticker<span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
             <span style="color:#3c5d5d;font-weight:bold">@Override</span>
             <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">long</span> <span style="color:#900;font-weight:bold">read</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
                     <span style="color:#000;font-weight:bold">return</span> 0<span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#000;font-weight:bold">})</span>
        <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">build</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">new</span> CacheLoader<span style="color:#000;font-weight:bold">&lt;</span>Object<span style="color:#000;font-weight:bold">,</span> Object<span style="color:#000;font-weight:bold">&gt;()</span> <span style="color:#000;font-weight:bold">{</span>
             <span style="color:#3c5d5d;font-weight:bold">@Override</span>
             <span style="color:#000;font-weight:bold">public</span> Object <span style="color:#900;font-weight:bold">load</span><span style="color:#000;font-weight:bold">(</span>Object name<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                     <span style="color:#998;font-style:italic">// 在cache找不到就取数据
</span><span style="color:#998;font-style:italic"></span>                     <span style="color:#000;font-weight:bold">return</span> String<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">format</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;重新load（%s）：%s&#34;</span><span style="color:#000;font-weight:bold">,</span> System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">currentTimeMillis</span><span style="color:#000;font-weight:bold">(),</span> name<span style="color:#000;font-weight:bold">);</span>
                    <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#000;font-weight:bold">});</span>

 <span style="color:#998;font-style:italic">// 简单使用
</span><span style="color:#998;font-style:italic"></span> userCache<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;hello&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#d14">&#34;world&#34;</span><span style="color:#000;font-weight:bold">);</span>
 System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span>userCache<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;hello&#34;</span><span style="color:#000;font-weight:bold">));</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="12-caffeine">1.2 caffeine</h3>
<p>caffeine常见参数解读：</p>
<pre><code>initialCapacity=[integer]: 初始的缓存空间大小   
maximumSize=[long]: 缓存的最大条数
maximumWeight=[long]: 缓存的最大权重
expireAfterAccess=[duration]: 最后一次写入或访问后经过固定时间过期
expireAfterWrite=[duration]: 最后一次写入后经过固定时间过期
refreshAfterWrite=[duration]: 创建缓存或者最近一次更新缓存后经过固定的时间间隔，刷新缓存

weakKeys: 打开key的弱引用
weakValues：打开value的弱引用
softValues：打开value的软引用
recordStats：开发统计功能

注意：
expireAfterWrite和expireAfterAccess同时存在时，以expireAfterWrite为准。
maximumSize和maximumWeight不可以同时使用
weakValues和softValues不可以同时使用
</code></pre><h2 id="2使用注解来对cache增删改查">2、使用注解来对cache增删改查</h2>
<p>我们可以使用spring提供的@Cacheable、@CachePut、@CacheEvict等注解来方便的使用caffeine缓存。</p>
<p>如果使用了多个cache，比如redis、caffeine等，必须指定某一个CacheManage为@primary，在@Cacheable注解中没指定 cacheManager 则使用标记为primary的那个。</p>
<h3 id="21-cache方面的注解主要有以下5个">2.1 cache方面的注解主要有以下5个：</h3>
<ul>
<li>@Cacheable 触发缓存入口（这里一般放在创建和获取的方法上，@Cacheable注解会先查询是否已经有缓存，有会使用缓存，没有则会执行方法并缓存）</li>
<li>@CacheEvict 触发缓存的eviction（用于删除的方法上）</li>
<li>@CachePut 更新缓存且不影响方法执行（用于修改的方法上，该注解下的方法始终会被执行）</li>
<li>@Caching 将多个缓存组合在一个方法上（该注解可以允许一个方法同时设置多个注解）</li>
<li>@CacheConfig 在类级别设置一些缓存相关的共同配置（与其它缓存配合使用）</li>
</ul>
<h4 id="211-说一下cacheable-和-cacheput的区别">2.1.1 说一下@Cacheable 和 @CachePut的区别：</h4>
<ul>
<li>@Cacheable：它的注解的方法是否被执行取决于Cacheable中的条件，方法很多时候都可能不被执行。</li>
<li>@CachePut：这个注解不会影响方法的执行，也就是说无论它配置的条件是什么，方法都会被执行，更多的时候是被用到修改上。</li>
</ul>
<h4 id="212-简要介绍cacheable类中各个方法的使用">2.1.2 简要介绍Cacheable类中各个方法的使用：</h4>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">public</span> <span style="color:#3c5d5d;font-weight:bold">@interface</span> Cacheable <span style="color:#000;font-weight:bold">{</span>

    <span style="color:#998;font-style:italic">/**
</span><span style="color:#998;font-style:italic">     * 要使用的cache的名字
</span><span style="color:#998;font-style:italic">     */</span>
    <span style="color:#3c5d5d;font-weight:bold">@AliasFor</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;cacheNames&#34;</span><span style="color:#000;font-weight:bold">)</span>
    String<span style="color:#000;font-weight:bold">[]</span> <span style="color:#900;font-weight:bold">value</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">default</span> <span style="color:#000;font-weight:bold">{};</span>

    <span style="color:#998;font-style:italic">/**
</span><span style="color:#998;font-style:italic">     * 同value()，决定要使用那个/些缓存
</span><span style="color:#998;font-style:italic">     */</span>
    <span style="color:#3c5d5d;font-weight:bold">@AliasFor</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;value&#34;</span><span style="color:#000;font-weight:bold">)</span>
    String<span style="color:#000;font-weight:bold">[]</span> <span style="color:#900;font-weight:bold">cacheNames</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">default</span> <span style="color:#000;font-weight:bold">{};</span>

    <span style="color:#998;font-style:italic">/**
</span><span style="color:#998;font-style:italic">     * 使用SpEL表达式来设定缓存的key，如果不设置默认方法上所有参数都会作为key的一部分
</span><span style="color:#998;font-style:italic">     */</span>
    String <span style="color:#900;font-weight:bold">key</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">default</span> <span style="color:#d14">&#34;&#34;</span><span style="color:#000;font-weight:bold">;</span>

    <span style="color:#998;font-style:italic">/**
</span><span style="color:#998;font-style:italic">     * 用来生成key，与key()不可以共用
</span><span style="color:#998;font-style:italic">     */</span>
    String <span style="color:#900;font-weight:bold">keyGenerator</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">default</span> <span style="color:#d14">&#34;&#34;</span><span style="color:#000;font-weight:bold">;</span>

    <span style="color:#998;font-style:italic">/**
</span><span style="color:#998;font-style:italic">     * 设定要使用的cacheManager，必须先设置好cacheManager的bean，这是使用该bean的名字
</span><span style="color:#998;font-style:italic">     */</span>
    String <span style="color:#900;font-weight:bold">cacheManager</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">default</span> <span style="color:#d14">&#34;&#34;</span><span style="color:#000;font-weight:bold">;</span>

    <span style="color:#998;font-style:italic">/**
</span><span style="color:#998;font-style:italic">     * 使用cacheResolver来设定使用的缓存，用法同cacheManager，但是与cacheManager不可以同时使用
</span><span style="color:#998;font-style:italic">     */</span>
    String <span style="color:#900;font-weight:bold">cacheResolver</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">default</span> <span style="color:#d14">&#34;&#34;</span><span style="color:#000;font-weight:bold">;</span>

    <span style="color:#998;font-style:italic">/**
</span><span style="color:#998;font-style:italic">     * 使用SpEL表达式设定出发缓存的条件，在方法执行前生效
</span><span style="color:#998;font-style:italic">     */</span>
    String <span style="color:#900;font-weight:bold">condition</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">default</span> <span style="color:#d14">&#34;&#34;</span><span style="color:#000;font-weight:bold">;</span>

    <span style="color:#998;font-style:italic">/**
</span><span style="color:#998;font-style:italic">     * 使用SpEL设置出发缓存的条件，这里是方法执行完生效，所以条件中可以有方法执行后的value
</span><span style="color:#998;font-style:italic">     */</span>
    String <span style="color:#900;font-weight:bold">unless</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">default</span> <span style="color:#d14">&#34;&#34;</span><span style="color:#000;font-weight:bold">;</span>

    <span style="color:#998;font-style:italic">/**
</span><span style="color:#998;font-style:italic">     * 用于同步的，在缓存失效（过期不存在等各种原因）的时候，如果多个线程同时访问被标注的方法
</span><span style="color:#998;font-style:italic">     * 则只允许一个线程通过去执行方法
</span><span style="color:#998;font-style:italic">     */</span>
    <span style="color:#458;font-weight:bold">boolean</span> <span style="color:#900;font-weight:bold">sync</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">default</span> <span style="color:#000;font-weight:bold">false</span><span style="color:#000;font-weight:bold">;</span>

<span style="color:#000;font-weight:bold">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="213-基于注解的使用方式">2.1.3 基于注解的使用方式</h4>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">com.rickiyang.learn.entity.User</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.springframework.cache.annotation.CacheEvict</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.springframework.cache.annotation.CachePut</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.springframework.cache.annotation.Cacheable</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.springframework.stereotype.Service</span><span style="color:#000;font-weight:bold">;</span>

<span style="color:#998;font-style:italic">/**
</span><span style="color:#998;font-style:italic"> * @author: Anttu
</span><span style="color:#998;font-style:italic"> * @date: 2021/10/11
</span><span style="color:#998;font-style:italic"> * @description: 本地cache
</span><span style="color:#998;font-style:italic"> */</span>
<span style="color:#3c5d5d;font-weight:bold">@Service</span>
<span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">UserCacheService</span> <span style="color:#000;font-weight:bold">{</span>


    <span style="color:#998;font-style:italic">/**
</span><span style="color:#998;font-style:italic">     * 查找
</span><span style="color:#998;font-style:italic">     * 先查缓存，如果查不到，会查数据库并存入缓存
</span><span style="color:#998;font-style:italic">     * @param id
</span><span style="color:#998;font-style:italic">     */</span>
    <span style="color:#3c5d5d;font-weight:bold">@Cacheable</span><span style="color:#000;font-weight:bold">(</span>value <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;userCache&#34;</span><span style="color:#000;font-weight:bold">,</span> key <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;#id&#34;</span><span style="color:#000;font-weight:bold">,</span> sync <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">getUser</span><span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">long</span> id<span style="color:#000;font-weight:bold">){</span>
        <span style="color:#998;font-style:italic">//查找数据库
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">}</span>

    <span style="color:#998;font-style:italic">/**
</span><span style="color:#998;font-style:italic">     * 更新/保存
</span><span style="color:#998;font-style:italic">     * @param user
</span><span style="color:#998;font-style:italic">     */</span>
    <span style="color:#3c5d5d;font-weight:bold">@CachePut</span><span style="color:#000;font-weight:bold">(</span>value <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;userCache&#34;</span><span style="color:#000;font-weight:bold">,</span> key <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;#user.id&#34;</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">saveUser</span><span style="color:#000;font-weight:bold">(</span>User user<span style="color:#000;font-weight:bold">){</span>
        <span style="color:#998;font-style:italic">//todo 保存数据库
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">}</span>


    <span style="color:#998;font-style:italic">/**
</span><span style="color:#998;font-style:italic">     * 删除
</span><span style="color:#998;font-style:italic">     * @param user
</span><span style="color:#998;font-style:italic">     */</span>
    <span style="color:#3c5d5d;font-weight:bold">@CacheEvict</span><span style="color:#000;font-weight:bold">(</span>value <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;userCache&#34;</span><span style="color:#000;font-weight:bold">,</span>key <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;#user.id&#34;</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">delUser</span><span style="color:#000;font-weight:bold">(</span>User user<span style="color:#000;font-weight:bold">){</span>
        <span style="color:#998;font-style:italic">//todo 保存数据库
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="3springboot中默认的缓存">3、springboot中默认的缓存</h2>
<ul>
<li>SpringBoot 1.x版本中的默认本地cache是Guava Cache。</li>
<li>在2.x（Spring Boot 2.0(spring 5) ）版本中已经用Caffeine Cache取代了Guava Cache。毕竟有了更优的缓存淘汰策略。</li>
</ul>
<h2 id="4springboot中使用caffeine">4、springboot中使用caffeine</h2>
<h3 id="41-pom中配置依赖">4.1 pom中配置依赖</h3>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#000080">&lt;dependency&gt;</span>
    <span style="color:#000080">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#000080">&lt;/groupId&gt;</span>
    <span style="color:#000080">&lt;artifactId&gt;</span>spring-boot-starter-cache<span style="color:#000080">&lt;/artifactId&gt;</span>
<span style="color:#000080">&lt;/dependency&gt;</span>
<span style="color:#000080">&lt;dependency&gt;</span>
    <span style="color:#000080">&lt;groupId&gt;</span>com.github.ben-manes.caffeine<span style="color:#000080">&lt;/groupId&gt;</span>
    <span style="color:#000080">&lt;artifactId&gt;</span>caffeine<span style="color:#000080">&lt;/artifactId&gt;</span>
    <span style="color:#000080">&lt;version&gt;</span>2.6.2<span style="color:#000080">&lt;/version&gt;</span>
<span style="color:#000080">&lt;/dependency&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="42-配置文件注入相关参数">4.2 配置文件注入相关参数</h3>
<h4 id="properties">properties</h4>
<pre><code class="language-properties" data-lang="properties">spring.cache.cache-names=cache1
spring.cache.caffeine.spec=initialCapacity=50,maximumSize=500,expireAfterWrite=10s
</code></pre><h4 id="yaml">yaml</h4>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#000080">spring</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#000080">cache</span>:<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">type</span>:<span style="color:#bbb"> </span>caffeine<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">cache-names</span>:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>- userCache<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">caffeine</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#000080">spec</span>:<span style="color:#bbb"> </span>maximumSize=1024,refreshAfterWrite=60s<span style="color:#bbb">
</span></code></pre></td></tr></table>
</div>
</div><h5 id="注">注：</h5>
<p>上面 properties 和 yaml 任选其一</p>
<h3 id="43-注解开启缓存支持">4.3 注解开启缓存支持</h3>
<p>添加@EnableCaching注解：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#3c5d5d;font-weight:bold">@SpringBootApplication</span>
<span style="color:#3c5d5d;font-weight:bold">@EnableCaching</span>
<span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">SingleDatabaseApplication</span> <span style="color:#000;font-weight:bold">{</span>

    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">main</span><span style="color:#000;font-weight:bold">(</span>String<span style="color:#000;font-weight:bold">[]</span> args<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
        SpringApplication<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">run</span><span style="color:#000;font-weight:bold">(</span>SingleDatabaseApplication<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">,</span> args<span style="color:#000;font-weight:bold">);</span>
    <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="44-cache-config实现">4.4 cache config实现</h3>
<ol>
<li>如果使用refreshAfterWrite配置,必须指定一个CacheLoader,不用该配置则无需这个bean,如上所述,该CacheLoader将关联被该缓存管理器管理的所有缓存,所以必须定义为CacheLoader&lt;Object, Object&gt;,自动配置将忽略所有泛型类型。</li>
</ol>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">com.github.benmanes.caffeine.cache.CacheLoader</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.springframework.context.annotation.Bean</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.springframework.context.annotation.Configuration</span><span style="color:#000;font-weight:bold">;</span>

<span style="color:#998;font-style:italic">/**
</span><span style="color:#998;font-style:italic"> * @author: Anttu
</span><span style="color:#998;font-style:italic"> * @date: 2021/10/11
</span><span style="color:#998;font-style:italic"> * @description:
</span><span style="color:#998;font-style:italic"> */</span>
<span style="color:#3c5d5d;font-weight:bold">@Configuration</span>
<span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">CacheConfig</span> <span style="color:#000;font-weight:bold">{</span>

    <span style="color:#998;font-style:italic">/**
</span><span style="color:#998;font-style:italic">     * 相当于在构建LoadingCache对象的时候 build()方法中指定过期之后的加载策略方法
</span><span style="color:#998;font-style:italic">     * 必须要指定这个Bean，refreshAfterWrite=60s属性才生效
</span><span style="color:#998;font-style:italic">     * @return
</span><span style="color:#998;font-style:italic">     */</span>
    <span style="color:#3c5d5d;font-weight:bold">@Bean</span>
    <span style="color:#000;font-weight:bold">public</span> CacheLoader<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span> Object<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#900;font-weight:bold">cacheLoader</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
        CacheLoader<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span> Object<span style="color:#000;font-weight:bold">&gt;</span> cacheLoader <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> CacheLoader<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span> Object<span style="color:#000;font-weight:bold">&gt;()</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#3c5d5d;font-weight:bold">@Override</span>
            <span style="color:#000;font-weight:bold">public</span> Object <span style="color:#900;font-weight:bold">load</span><span style="color:#000;font-weight:bold">(</span>String key<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">throws</span> Exception <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#998;font-style:italic">// 重写这个方法将oldValue值返回回去，进而刷新缓存
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#3c5d5d;font-weight:bold">@Override</span>
            <span style="color:#000;font-weight:bold">public</span> Object <span style="color:#900;font-weight:bold">reload</span><span style="color:#000;font-weight:bold">(</span>String key<span style="color:#000;font-weight:bold">,</span> Object oldValue<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">throws</span> Exception <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#000;font-weight:bold">return</span> oldValue<span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#000;font-weight:bold">};</span>
        <span style="color:#000;font-weight:bold">return</span> cacheLoader<span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>一般情况下你也可以选择使用bean的方式来初始化Cache实例</li>
</ol>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">76
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">77
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">78
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">79
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">80
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">81
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">82
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">83
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">84
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">85
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">86
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">87
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">88
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">89
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">90
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">91
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">92
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">93
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">94
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">95
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">96
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">97
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">com.github.benmanes.caffeine.cache.CacheLoader</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">com.github.benmanes.caffeine.cache.Caffeine</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.apache.commons.compress.utils.Lists</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.springframework.cache.CacheManager</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.springframework.cache.caffeine.CaffeineCache</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.springframework.cache.support.SimpleCacheManager</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.springframework.context.annotation.Bean</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.springframework.context.annotation.Configuration</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.springframework.context.annotation.Primary</span><span style="color:#000;font-weight:bold">;</span>

<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">java.util.ArrayList</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">java.util.List</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">java.util.concurrent.TimeUnit</span><span style="color:#000;font-weight:bold">;</span>

<span style="color:#998;font-style:italic">/**
</span><span style="color:#998;font-style:italic"> * @author: Anttu
</span><span style="color:#998;font-style:italic"> * @date: 2021/10/11
</span><span style="color:#998;font-style:italic"> * @description:
</span><span style="color:#998;font-style:italic"> */</span>
<span style="color:#3c5d5d;font-weight:bold">@Configuration</span>
<span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">CacheConfig</span> <span style="color:#000;font-weight:bold">{</span>

    <span style="color:#998;font-style:italic">/**
</span><span style="color:#998;font-style:italic">     * 创建基于Caffeine的Cache Manager
</span><span style="color:#998;font-style:italic">     * 初始化一些key存入
</span><span style="color:#998;font-style:italic">     * @return
</span><span style="color:#998;font-style:italic">     */</span>
    <span style="color:#3c5d5d;font-weight:bold">@Bean</span>
    <span style="color:#3c5d5d;font-weight:bold">@Primary</span>
    <span style="color:#000;font-weight:bold">public</span> CacheManager <span style="color:#900;font-weight:bold">caffeineCacheManager</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
        SimpleCacheManager cacheManager <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> SimpleCacheManager<span style="color:#000;font-weight:bold">();</span>
        ArrayList<span style="color:#000;font-weight:bold">&lt;</span>CaffeineCache<span style="color:#000;font-weight:bold">&gt;</span> caches <span style="color:#000;font-weight:bold">=</span> Lists<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">newArrayList</span><span style="color:#000;font-weight:bold">();</span>
        List<span style="color:#000;font-weight:bold">&lt;</span>CacheBean<span style="color:#000;font-weight:bold">&gt;</span> list <span style="color:#000;font-weight:bold">=</span> setCacheBean<span style="color:#000;font-weight:bold">();</span>
        <span style="color:#000;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span>CacheBean cacheBean <span style="color:#000;font-weight:bold">:</span> list<span style="color:#000;font-weight:bold">){</span>
            caches<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">add</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">new</span> CaffeineCache<span style="color:#000;font-weight:bold">(</span>cacheBean<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getKey</span><span style="color:#000;font-weight:bold">(),</span>
                    Caffeine<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">newBuilder</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">recordStats</span><span style="color:#000;font-weight:bold">()</span>
                            <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">expireAfterWrite</span><span style="color:#000;font-weight:bold">(</span>cacheBean<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getTtl</span><span style="color:#000;font-weight:bold">(),</span> TimeUnit<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">SECONDS</span><span style="color:#000;font-weight:bold">)</span>
                            <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">maximumSize</span><span style="color:#000;font-weight:bold">(</span>cacheBean<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getMaximumSize</span><span style="color:#000;font-weight:bold">())</span>
                            <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">build</span><span style="color:#000;font-weight:bold">()));</span>
        <span style="color:#000;font-weight:bold">}</span>
        cacheManager<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setCaches</span><span style="color:#000;font-weight:bold">(</span>caches<span style="color:#000;font-weight:bold">);</span>
        <span style="color:#000;font-weight:bold">return</span> cacheManager<span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000;font-weight:bold">}</span>

    <span style="color:#998;font-style:italic">/**
</span><span style="color:#998;font-style:italic">     * 初始化一些缓存的 key
</span><span style="color:#998;font-style:italic">     * @return
</span><span style="color:#998;font-style:italic">     */</span>
    <span style="color:#000;font-weight:bold">private</span> List<span style="color:#000;font-weight:bold">&lt;</span>CacheBean<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#900;font-weight:bold">setCacheBean</span><span style="color:#000;font-weight:bold">(){</span>
        List<span style="color:#000;font-weight:bold">&lt;</span>CacheBean<span style="color:#000;font-weight:bold">&gt;</span> list <span style="color:#000;font-weight:bold">=</span> Lists<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">newArrayList</span><span style="color:#000;font-weight:bold">();</span>
        CacheBean userCache <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> CacheBean<span style="color:#000;font-weight:bold">();</span>
        userCache<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setKey</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;userCache&#34;</span><span style="color:#000;font-weight:bold">);</span>
        userCache<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setTtl</span><span style="color:#000;font-weight:bold">(</span>60<span style="color:#000;font-weight:bold">);</span>
        userCache<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setMaximumSize</span><span style="color:#000;font-weight:bold">(</span>10000<span style="color:#000;font-weight:bold">);</span>

        CacheBean deptCache <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> CacheBean<span style="color:#000;font-weight:bold">();</span>
        deptCache<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setKey</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;userCache&#34;</span><span style="color:#000;font-weight:bold">);</span>
        deptCache<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setTtl</span><span style="color:#000;font-weight:bold">(</span>60<span style="color:#000;font-weight:bold">);</span>
        deptCache<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setMaximumSize</span><span style="color:#000;font-weight:bold">(</span>10000<span style="color:#000;font-weight:bold">);</span>

        list<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">add</span><span style="color:#000;font-weight:bold">(</span>userCache<span style="color:#000;font-weight:bold">);</span>
        list<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">add</span><span style="color:#000;font-weight:bold">(</span>deptCache<span style="color:#000;font-weight:bold">);</span>

        <span style="color:#000;font-weight:bold">return</span> list<span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000;font-weight:bold">}</span>

    <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">CacheBean</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">private</span> String key<span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">private</span> <span style="color:#458;font-weight:bold">long</span> ttl<span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">private</span> <span style="color:#458;font-weight:bold">long</span> maximumSize<span style="color:#000;font-weight:bold">;</span>

        <span style="color:#000;font-weight:bold">public</span> String <span style="color:#900;font-weight:bold">getKey</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">return</span> key<span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>

        <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">setKey</span><span style="color:#000;font-weight:bold">(</span>String key<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">key</span> <span style="color:#000;font-weight:bold">=</span> key<span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>

        <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">long</span> <span style="color:#900;font-weight:bold">getTtl</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">return</span> ttl<span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>

        <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">setTtl</span><span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">long</span> ttl<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">ttl</span> <span style="color:#000;font-weight:bold">=</span> ttl<span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>

        <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">long</span> <span style="color:#900;font-weight:bold">getMaximumSize</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">return</span> maximumSize<span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>

        <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">setMaximumSize</span><span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">long</span> maximumSize<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">maximumSize</span> <span style="color:#000;font-weight:bold">=</span> maximumSize<span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">}</span>

<span style="color:#000;font-weight:bold">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="5缓存统计">5、缓存统计</h2>
<p>与Guava Cache的统计一样。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">Cache&lt;String, Object&gt; <span style="color:#008080">cache</span> <span style="color:#000;font-weight:bold">=</span> Caffeine.newBuilder<span style="color:#000;font-weight:bold">()</span>
    .maximumSize<span style="color:#000;font-weight:bold">(</span>10_000<span style="color:#000;font-weight:bold">)</span>
    .recordStats<span style="color:#000;font-weight:bold">()</span>
    .build<span style="color:#000;font-weight:bold">()</span>;
</code></pre></td></tr></table>
</div>
</div><p>通过使用Caffeine.recordStats(), 可以转化成一个统计的集合. 通过 Cache.stats() 返回一个CacheStats。CacheStats提供以下统计方法：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">hitRate<span style="color:#000;font-weight:bold">();</span>            <span style="color:#998;font-style:italic">//返回缓存命中率
</span><span style="color:#998;font-style:italic"></span>evictionCount<span style="color:#000;font-weight:bold">();</span>      <span style="color:#998;font-style:italic">//缓存回收数量
</span><span style="color:#998;font-style:italic"></span>averageLoadPenalty<span style="color:#000;font-weight:bold">();</span> <span style="color:#998;font-style:italic">//加载新值的平均时间
</span></code></pre></td></tr></table>
</div>
</div><h2 id="6缓存填充策略">6、缓存填充策略</h2>
<p>Caffeine Cache提供了三种缓存填充策略：手动、同步加载和异步加载。</p>
<h3 id="61-手动加载">6.1 手动加载</h3>
<p>在每次get key的时候指定一个同步的函数，如果key不存在就调用这个函数生成一个值。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#998;font-style:italic">/**
</span><span style="color:#998;font-style:italic"> * 手动加载
</span><span style="color:#998;font-style:italic"> * @param key
</span><span style="color:#998;font-style:italic"> * @return
</span><span style="color:#998;font-style:italic"> */</span>
<span style="color:#000;font-weight:bold">public</span> Object <span style="color:#900;font-weight:bold">manulOperator</span><span style="color:#000;font-weight:bold">(</span>String key<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
    Cache<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span> Object<span style="color:#000;font-weight:bold">&gt;</span> cache <span style="color:#000;font-weight:bold">=</span> Caffeine<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">newBuilder</span><span style="color:#000;font-weight:bold">()</span>
        <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">expireAfterWrite</span><span style="color:#000;font-weight:bold">(</span>1<span style="color:#000;font-weight:bold">,</span> TimeUnit<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">SECONDS</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">expireAfterAccess</span><span style="color:#000;font-weight:bold">(</span>1<span style="color:#000;font-weight:bold">,</span> TimeUnit<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">SECONDS</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">maximumSize</span><span style="color:#000;font-weight:bold">(</span>10<span style="color:#000;font-weight:bold">)</span>
        <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">build</span><span style="color:#000;font-weight:bold">();</span>
    <span style="color:#998;font-style:italic">//如果一个key不存在，那么会进入指定的函数生成value
</span><span style="color:#998;font-style:italic"></span>    Object value <span style="color:#000;font-weight:bold">=</span> cache<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">(</span>key<span style="color:#000;font-weight:bold">,</span> t <span style="color:#000;font-weight:bold">-&gt;</span> setValue<span style="color:#000;font-weight:bold">(</span>key<span style="color:#000;font-weight:bold">).</span><span style="color:#008080">apply</span><span style="color:#000;font-weight:bold">(</span>key<span style="color:#000;font-weight:bold">));</span>
    cache<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;hello&#34;</span><span style="color:#000;font-weight:bold">,</span>value<span style="color:#000;font-weight:bold">);</span>

    <span style="color:#998;font-style:italic">//判断是否存在如果不存返回null
</span><span style="color:#998;font-style:italic"></span>    Object ifPresent <span style="color:#000;font-weight:bold">=</span> cache<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getIfPresent</span><span style="color:#000;font-weight:bold">(</span>key<span style="color:#000;font-weight:bold">);</span>
    <span style="color:#998;font-style:italic">//移除一个key
</span><span style="color:#998;font-style:italic"></span>    cache<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">invalidate</span><span style="color:#000;font-weight:bold">(</span>key<span style="color:#000;font-weight:bold">);</span>
    <span style="color:#000;font-weight:bold">return</span> value<span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">}</span>

<span style="color:#000;font-weight:bold">public</span> Function<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span> Object<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#900;font-weight:bold">setValue</span><span style="color:#000;font-weight:bold">(</span>String key<span style="color:#000;font-weight:bold">){</span>
    <span style="color:#000;font-weight:bold">return</span> t <span style="color:#000;font-weight:bold">-&gt;</span> key <span style="color:#000;font-weight:bold">+</span> <span style="color:#d14">&#34;value&#34;</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="62-同步加载">6.2 同步加载</h3>
<p>构造Cache时候，build方法传入一个CacheLoader实现类。实现load方法，通过key加载value。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#998;font-style:italic">/**
</span><span style="color:#998;font-style:italic"> * 同步加载
</span><span style="color:#998;font-style:italic"> * @param key
</span><span style="color:#998;font-style:italic"> * @return
</span><span style="color:#998;font-style:italic"> */</span>
<span style="color:#000;font-weight:bold">public</span> Object <span style="color:#900;font-weight:bold">syncOperator</span><span style="color:#000;font-weight:bold">(</span>String key<span style="color:#000;font-weight:bold">){</span>
    LoadingCache<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span> Object<span style="color:#000;font-weight:bold">&gt;</span> cache <span style="color:#000;font-weight:bold">=</span> Caffeine<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">newBuilder</span><span style="color:#000;font-weight:bold">()</span>
        <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">maximumSize</span><span style="color:#000;font-weight:bold">(</span>100<span style="color:#000;font-weight:bold">)</span>
        <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">expireAfterWrite</span><span style="color:#000;font-weight:bold">(</span>1<span style="color:#000;font-weight:bold">,</span> TimeUnit<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">MINUTES</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">build</span><span style="color:#000;font-weight:bold">(</span>k <span style="color:#000;font-weight:bold">-&gt;</span> setValue<span style="color:#000;font-weight:bold">(</span>key<span style="color:#000;font-weight:bold">).</span><span style="color:#008080">apply</span><span style="color:#000;font-weight:bold">(</span>key<span style="color:#000;font-weight:bold">));</span>
    <span style="color:#000;font-weight:bold">return</span> cache<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">(</span>key<span style="color:#000;font-weight:bold">);</span>
<span style="color:#000;font-weight:bold">}</span>

<span style="color:#000;font-weight:bold">public</span> Function<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span> Object<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#900;font-weight:bold">setValue</span><span style="color:#000;font-weight:bold">(</span>String key<span style="color:#000;font-weight:bold">){</span>
    <span style="color:#000;font-weight:bold">return</span> t <span style="color:#000;font-weight:bold">-&gt;</span> key <span style="color:#000;font-weight:bold">+</span> <span style="color:#d14">&#34;value&#34;</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="63-异步加载">6.3. 异步加载</h3>
<p>AsyncLoadingCache是继承自LoadingCache类的，异步加载使用Executor去调用方法并返回一个CompletableFuture。异步加载缓存使用了响应式编程模型。</p>
<p>如果要以同步方式调用时，应提供CacheLoader。要以异步表示时，应该提供一个AsyncCacheLoader，并返回一个CompletableFuture。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#998;font-style:italic">/**
</span><span style="color:#998;font-style:italic"> * 异步加载
</span><span style="color:#998;font-style:italic"> * @param key
</span><span style="color:#998;font-style:italic"> * @return
</span><span style="color:#998;font-style:italic"> */</span>
<span style="color:#000;font-weight:bold">public</span> Object <span style="color:#900;font-weight:bold">asyncOperator</span><span style="color:#000;font-weight:bold">(</span>String key<span style="color:#000;font-weight:bold">){</span>
    AsyncLoadingCache<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span> Object<span style="color:#000;font-weight:bold">&gt;</span> cache <span style="color:#000;font-weight:bold">=</span> Caffeine<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">newBuilder</span><span style="color:#000;font-weight:bold">()</span>
        <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">maximumSize</span><span style="color:#000;font-weight:bold">(</span>100<span style="color:#000;font-weight:bold">)</span>
        <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">expireAfterWrite</span><span style="color:#000;font-weight:bold">(</span>1<span style="color:#000;font-weight:bold">,</span> TimeUnit<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">MINUTES</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">buildAsync</span><span style="color:#000;font-weight:bold">(</span>k <span style="color:#000;font-weight:bold">-&gt;</span> setAsyncValue<span style="color:#000;font-weight:bold">(</span>key<span style="color:#000;font-weight:bold">).</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">());</span>

    <span style="color:#000;font-weight:bold">return</span> cache<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">(</span>key<span style="color:#000;font-weight:bold">);</span>
<span style="color:#000;font-weight:bold">}</span>

<span style="color:#000;font-weight:bold">public</span> CompletableFuture<span style="color:#000;font-weight:bold">&lt;</span>Object<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#900;font-weight:bold">setAsyncValue</span><span style="color:#000;font-weight:bold">(</span>String key<span style="color:#000;font-weight:bold">){</span>
    <span style="color:#000;font-weight:bold">return</span> CompletableFuture<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">supplyAsync</span><span style="color:#000;font-weight:bold">(()</span> <span style="color:#000;font-weight:bold">-&gt;</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">return</span> key <span style="color:#000;font-weight:bold">+</span> <span style="color:#d14">&#34;value&#34;</span><span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000;font-weight:bold">});</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="7缓存回收策略">7、缓存回收策略</h2>
<p>Caffeine提供了3种回收策略：基于大小回收，基于时间回收，基于引用回收。</p>
<h3 id="71-基于大小的过期方式">7.1 基于大小的过期方式</h3>
<p>基于大小的回收策略有两种方式：一种是基于缓存大小，一种是基于权重。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#998;font-style:italic">// 根据缓存的计数进行驱逐
</span><span style="color:#998;font-style:italic"></span>LoadingCache<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span> Object<span style="color:#000;font-weight:bold">&gt;</span> cache <span style="color:#000;font-weight:bold">=</span> Caffeine<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">newBuilder</span><span style="color:#000;font-weight:bold">()</span>
    <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">maximumSize</span><span style="color:#000;font-weight:bold">(</span>10000<span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">build</span><span style="color:#000;font-weight:bold">(</span>key <span style="color:#000;font-weight:bold">-&gt;</span> function<span style="color:#000;font-weight:bold">(</span>key<span style="color:#000;font-weight:bold">));</span>


<span style="color:#998;font-style:italic">// 根据缓存的权重来进行驱逐（权重只是用于确定缓存大小，不会用于决定该缓存是否被驱逐）
</span><span style="color:#998;font-style:italic"></span>LoadingCache<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span> Object<span style="color:#000;font-weight:bold">&gt;</span> cache1 <span style="color:#000;font-weight:bold">=</span> Caffeine<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">newBuilder</span><span style="color:#000;font-weight:bold">()</span>
    <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">maximumWeight</span><span style="color:#000;font-weight:bold">(</span>10000<span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">weigher</span><span style="color:#000;font-weight:bold">(</span>key <span style="color:#000;font-weight:bold">-&gt;</span> function1<span style="color:#000;font-weight:bold">(</span>key<span style="color:#000;font-weight:bold">))</span>
    <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">build</span><span style="color:#000;font-weight:bold">(</span>key <span style="color:#000;font-weight:bold">-&gt;</span> function<span style="color:#000;font-weight:bold">(</span>key<span style="color:#000;font-weight:bold">));</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="注意">注意：</h4>
<p>maximumWeight与maximumSize不可以同时使用。</p>
<h3 id="72-基于时间的过期方式">7.2 基于时间的过期方式</h3>
<p>Caffeine提供了三种定时驱逐策略：</p>
<ul>
<li>expireAfterAccess(long, TimeUnit):在最后一次访问或者写入后开始计时，在指定的时间后过期。假如一直有请求访问该key，那么这个缓存将一直不会过期。</li>
<li>expireAfterWrite(long, TimeUnit): 在最后一次写入缓存后开始计时，在指定的时间后过期。</li>
<li>expireAfter(Expiry): 自定义策略，过期时间由Expiry实现独自计算。
缓存的删除策略使用的是惰性删除和定时删除。这两个删除策略的时间复杂度都是O(1)。</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#998;font-style:italic">// 基于固定的到期策略进行退出
</span><span style="color:#998;font-style:italic"></span>LoadingCache<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span> Object<span style="color:#000;font-weight:bold">&gt;</span> cache <span style="color:#000;font-weight:bold">=</span> Caffeine<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">newBuilder</span><span style="color:#000;font-weight:bold">()</span>
    <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">expireAfterAccess</span><span style="color:#000;font-weight:bold">(</span>5<span style="color:#000;font-weight:bold">,</span> TimeUnit<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">MINUTES</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">build</span><span style="color:#000;font-weight:bold">(</span>key <span style="color:#000;font-weight:bold">-&gt;</span> function<span style="color:#000;font-weight:bold">(</span>key<span style="color:#000;font-weight:bold">));</span>
LoadingCache<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span> Object<span style="color:#000;font-weight:bold">&gt;</span> cache1 <span style="color:#000;font-weight:bold">=</span> Caffeine<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">newBuilder</span><span style="color:#000;font-weight:bold">()</span>
    <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">expireAfterWrite</span><span style="color:#000;font-weight:bold">(</span>10<span style="color:#000;font-weight:bold">,</span> TimeUnit<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">MINUTES</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">build</span><span style="color:#000;font-weight:bold">(</span>key <span style="color:#000;font-weight:bold">-&gt;</span> function<span style="color:#000;font-weight:bold">(</span>key<span style="color:#000;font-weight:bold">));</span>

<span style="color:#998;font-style:italic">// 基于不同的到期策略进行退出
</span><span style="color:#998;font-style:italic"></span>LoadingCache<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span> Object<span style="color:#000;font-weight:bold">&gt;</span> cache2 <span style="color:#000;font-weight:bold">=</span> Caffeine<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">newBuilder</span><span style="color:#000;font-weight:bold">()</span>
    <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">expireAfter</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">new</span> Expiry<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span> Object<span style="color:#000;font-weight:bold">&gt;()</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#3c5d5d;font-weight:bold">@Override</span>
        <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">long</span> <span style="color:#900;font-weight:bold">expireAfterCreate</span><span style="color:#000;font-weight:bold">(</span>String key<span style="color:#000;font-weight:bold">,</span> Object value<span style="color:#000;font-weight:bold">,</span> <span style="color:#458;font-weight:bold">long</span> currentTime<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">return</span> TimeUnit<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">SECONDS</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">toNanos</span><span style="color:#000;font-weight:bold">(</span>seconds<span style="color:#000;font-weight:bold">);</span>
        <span style="color:#000;font-weight:bold">}</span>

        <span style="color:#3c5d5d;font-weight:bold">@Override</span>
        <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">long</span> <span style="color:#900;font-weight:bold">expireAfterUpdate</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3c5d5d;font-weight:bold">@Nonnull</span> String s<span style="color:#000;font-weight:bold">,</span> <span style="color:#3c5d5d;font-weight:bold">@Nonnull</span> Object o<span style="color:#000;font-weight:bold">,</span> <span style="color:#458;font-weight:bold">long</span> l<span style="color:#000;font-weight:bold">,</span> <span style="color:#458;font-weight:bold">long</span> l1<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">return</span> 0<span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>

        <span style="color:#3c5d5d;font-weight:bold">@Override</span>
        <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">long</span> <span style="color:#900;font-weight:bold">expireAfterRead</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3c5d5d;font-weight:bold">@Nonnull</span> String s<span style="color:#000;font-weight:bold">,</span> <span style="color:#3c5d5d;font-weight:bold">@Nonnull</span> Object o<span style="color:#000;font-weight:bold">,</span> <span style="color:#458;font-weight:bold">long</span> l<span style="color:#000;font-weight:bold">,</span> <span style="color:#458;font-weight:bold">long</span> l1<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">return</span> 0<span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">}).</span><span style="color:#008080">build</span><span style="color:#000;font-weight:bold">(</span>key <span style="color:#000;font-weight:bold">-&gt;</span> function<span style="color:#000;font-weight:bold">(</span>key<span style="color:#000;font-weight:bold">));</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="73-基于引用的过期方式">7.3 基于引用的过期方式</h3>
<p>Java中四种引用类型</p>
<table>
<thead>
<tr>
<th>引用类型</th>
<th>被垃圾回收时间</th>
<th>用途</th>
<th>生存时间</th>
</tr>
</thead>
<tbody>
<tr>
<td>强引用StrongReference</td>
<td>从来不会</td>
<td>对象的一般状态</td>
<td>JVM停止运行时终止</td>
</tr>
<tr>
<td>软引用SoftReference</td>
<td>在内存不足时</td>
<td>对象缓存</td>
<td>内存不足时终止</td>
</tr>
<tr>
<td>弱引用WeakReference</td>
<td>在垃圾回收时</td>
<td>对象缓存</td>
<td>gc运行后终止</td>
</tr>
<tr>
<td>虚引用PhantomReference</td>
<td>从来不会</td>
<td>可以用虚引用来跟踪对象被垃圾回收器回收的活动，当一个虚引用关联的对象被垃圾收集器回收之前会收到一条系统通知</td>
<td>JVM停止运行时终止</td>
</tr>
</tbody>
</table>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#998;font-style:italic">// 当key和value都没有引用时驱逐缓存
</span><span style="color:#998;font-style:italic"></span>LoadingCache<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span> Object<span style="color:#000;font-weight:bold">&gt;</span> cache <span style="color:#000;font-weight:bold">=</span> Caffeine<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">newBuilder</span><span style="color:#000;font-weight:bold">()</span>
    <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">weakKeys</span><span style="color:#000;font-weight:bold">()</span>
    <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">weakValues</span><span style="color:#000;font-weight:bold">()</span>
    <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">build</span><span style="color:#000;font-weight:bold">(</span>key <span style="color:#000;font-weight:bold">-&gt;</span> function<span style="color:#000;font-weight:bold">(</span>key<span style="color:#000;font-weight:bold">));</span>

<span style="color:#998;font-style:italic">// 当垃圾收集器需要释放内存时驱逐
</span><span style="color:#998;font-style:italic"></span>LoadingCache<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span> Object<span style="color:#000;font-weight:bold">&gt;</span> cache1 <span style="color:#000;font-weight:bold">=</span> Caffeine<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">newBuilder</span><span style="color:#000;font-weight:bold">()</span>
    <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">softValues</span><span style="color:#000;font-weight:bold">()</span>
    <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">build</span><span style="color:#000;font-weight:bold">(</span>key <span style="color:#000;font-weight:bold">-&gt;</span> function<span style="color:#000;font-weight:bold">(</span>key<span style="color:#000;font-weight:bold">));</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="注意-1">注意：</h4>
<p>AsyncLoadingCache不支持弱引用和软引用。</p>
<ul>
<li>Caffeine.weakKeys()： 使用弱引用存储key。如果没有其他地方对该key有强引用，那么该缓存就会被垃圾回收器回收。由于垃圾回收器只依赖于身份(identity)相等，因此这会导致整个缓存使用身份 (==) 相等来比较 key，而不是使用 equals()。</li>
<li>Caffeine.weakValues() ：使用弱引用存储value。如果没有其他地方对该value有强引用，那么该缓存就会被垃圾回收器回收。由于垃圾回收器只依赖于身份(identity)相等，因此这会导致整个缓存使用身份 (==) 相等来比较 key，而不是使用 equals()。</li>
<li>Caffeine.softValues() ：使用软引用存储value。当内存满了过后，软引用的对象以将使用最近最少使用(least-recently-used ) 的方式进行垃圾回收。由于使用软引用是需要等到内存满了才进行回收，所以我们通常建议给缓存配置一个使用内存的最大值。 softValues() 将使用身份相等(identity) (==) 而不是equals() 来比较值。</li>
</ul>
<p>Caffeine.weakValues()和Caffeine.softValues()不可以一起使用。</p>
<h2 id="8参考和引用">8、参考和引用</h2>
<p>Caffeine：<a href="https://blog.csdn.net/a953713428/article/details/92159746">https://blog.csdn.net/a953713428/article/details/92159746</a><br>
Guava：<a href="https://blog.csdn.net/a953713428/article/details/91672602">https://blog.csdn.net/a953713428/article/details/91672602</a></p>

        </div>

        
<div class="post-archive">
    <ul class="post-copyright">
        <li><strong>原文作者：</strong><a rel="author" href="https://anTtutu.github.io/">Anttu</a></li>
        <li style="word-break:break-all"><strong>原文链接：</strong><a href="https://anTtutu.github.io/post/2021-10-11-caffeine_springcache/">https://anTtutu.github.io/post/2021-10-11-caffeine_springcache/</a></li>
        <li><strong>版权声明：</strong>本作品采用<a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/">知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议</a>进行许可，非商业转载请注明出处（作者，原文链接），商业转载请联系作者获得授权。</li>
    </ul>
</div>
<br/>



        

<div class="post-archive">
    <h2>See Also</h2>
    <ul class="listing">
        
        <li><a href="/post/2021-10-07-safe_coding_js/">前端编码安全</a></li>
        
        <li><a href="/post/2021-09-30-safe_coding_java/">java编码安全</a></li>
        
        <li><a href="/post/2021-09-19-maven_verify/">maven校验依赖包CVE漏洞</a></li>
        
        <li><a href="/post/2021-08-10-jvm_dump_analyse/">jvm的大dump文件分析</a></li>
        
        <li><a href="/post/2021-07-15-maven_scope/">maven的scope参数</a></li>
        
    </ul>
</div>


        <div class="post-meta meta-tags">
            
            没有标签
            
        </div>
    </article>
    
    

    
    
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "anTtutu/anTtutu.github.io"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
      </script>
    </div>
    
</div>

                    <footer id="footer">
    <div>
        &copy; 2022 <a href="https://anTtutu.github.io/">Anttu&#39;s Blog By Anttu</a>
        
    </div>
    <br />
    <div>
        <div class="github-badge">
            <a href="https://gohugo.io/" target="_black" rel="nofollow"><span class="badge-subject">Powered by</span><span class="badge-value bg-blue">Hugo</span></a>
        </div>
        
        <div class="github-badge">
            <a href="https://github.com/flysnow-org/maupassant-hugo" target="_black"><span class="badge-subject">Theme</span><span class="badge-value bg-yellowgreen">Maupassant</span></a>
        </div>
    </div>
</footer>


    
    <script type="text/javascript">
        window.MathJax = {
            tex2jax: {
                inlineMath: [['$', '$']],
                processEscapes: true
                }
            };
    </script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src='/js/totop.js?v=0.0.0' async=""></script>



    <script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>




    <script src='/js/asciinema-player.js'></script>

                </div>

                <div id="secondary">
    <section class="widget">
        <form id="search" action='https://anTtutu.github.io/search/' method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="https://anTtutu.github.io/">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>
    
    <section class="widget">
        <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    
    <li>
        <a href="https://anTtutu.github.io/post/2022-02-07-spring_cli/" title="spring boot cli&amp;spring cloud cli简单介绍">spring boot cli&amp;spring cloud cli简单介绍</a>
    </li>
    
    <li>
        <a href="https://anTtutu.github.io/post/2022-02-13-logrotate/" title="spring boot cli&amp;spring cloud cli简单介绍">spring boot cli&amp;spring cloud cli简单介绍</a>
    </li>
    
    <li>
        <a href="https://anTtutu.github.io/post/2022-01-26-miner_virus_4/" title="挖矿病毒4-容器挖矿病毒清理">挖矿病毒4-容器挖矿病毒清理</a>
    </li>
    
    <li>
        <a href="https://anTtutu.github.io/post/2022-01-24-miner_virus_3/" title="挖矿病毒3-分析和清理过程">挖矿病毒3-分析和清理过程</a>
    </li>
    
    <li>
        <a href="https://anTtutu.github.io/post/2022-01-07-regexp/" title="一些正则小细节-不定期补充">一些正则小细节-不定期补充</a>
    </li>
    
    <li>
        <a href="https://anTtutu.github.io/post/2022-01-06-sdkman/" title="sdkman的使用">sdkman的使用</a>
    </li>
    
    <li>
        <a href="https://anTtutu.github.io/post/2021-12-23-mysql_table_clean/" title="mysql大表的数据清理">mysql大表的数据清理</a>
    </li>
    
    <li>
        <a href="https://anTtutu.github.io/post/2021-12-17-nmap/" title="nmap参数详解">nmap参数详解</a>
    </li>
    
    <li>
        <a href="https://anTtutu.github.io/post/2021-12-13-log4j2_cve/" title="log4j2远程执行漏洞">log4j2远程执行漏洞</a>
    </li>
    
    <li>
        <a href="https://anTtutu.github.io/post/2021-11-19-lombok/" title="lombok一些注解的含义">lombok一些注解的含义</a>
    </li>
    
</ul>
    </section>

    

    <section class="widget">
        <h3 class="widget-title"><a href='/categories/'>分类</a></h3>
<ul class="widget-list">
    
    <li><a href="https://anTtutu.github.io/categories/about/">about (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/android/">android (2)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/app/">app (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/aria2/">aria2 (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/arm64/">arm64 (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/awr/">awr (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/backup/">backup (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/blog/">blog (3)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/bug/">bug (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/build/">build (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/cache/">cache (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/caffeine/">caffeine (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/captcha/">captcha (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/check/">check (4)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/clean/">clean (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/cli/">cli (2)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/cluster/">cluster (4)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/cve/">cve (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/cygwin/">cygwin (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/dataguard/">dataguard (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/deepfacelab/">deepfacelab (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/docker/">docker (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/dos/">dos (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/dump/">dump (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/eclipse/">eclipse (2)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/explain/">explain (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/faker/">faker (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/gcc/">gcc (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/git/">git (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/gitment/">gitment (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/gitpages/">gitpages (2)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/go/">go (4)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/h2/">h2 (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/h5/">h5 (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/ha/">ha (4)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/http/">http (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/hugo/">hugo (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/java/">java (24)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/jekyll/">jekyll (2)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/jrebel/">jrebel (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/js/">js (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/jsr/">jsr (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/jvm/">jvm (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/kafka/">kafka (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/kali/">kali (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/kenlm/">kenlm (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/linux/">linux (16)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/log4j/">log4j (2)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/lombok/">lombok (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/mac/">mac (4)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/matplotlib/">matplotlib (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/maven/">maven (2)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/mine/">mine (4)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/mongodb/">mongodb (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/mysql/">mysql (5)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/nginx/">nginx (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/nmap/">nmap (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/oom/">oom (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/oracle/">oracle (3)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/orangePi/">orangePi (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/pandas/">pandas (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/port/">port (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/python/">python (6)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/rec/">rec (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/redis/">redis (2)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/regexp/">regexp (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/safe/">safe (4)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/sdkman/">sdkman (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/shell/">shell (2)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/springboot/">springboot (4)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/sqlmap/">sqlmap (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/ssd/">ssd (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/tcp/">tcp (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/termux/">termux (2)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/test/">test (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/union_id/">union_id (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/vcs/">vcs (7)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/virus/">virus (4)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/vxvm/">vxvm (3)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/win10/">win10 (6)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/xrebel/">xrebel (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/ynote/">ynote (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/zk/">zk (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/zookeeper/">zookeeper (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/%E5%89%8D%E7%AB%AF/">前端 (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/%E5%AE%B9%E7%81%BE/">容灾 (1)</a></li>
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title"><a href='/tags/'>标签</a></h3>
<div class="tagcloud">
    
    <a href="https://anTtutu.github.io/tags/about/">about</a>
    
    <a href="https://anTtutu.github.io/tags/android/">android</a>
    
    <a href="https://anTtutu.github.io/tags/app/">app</a>
    
    <a href="https://anTtutu.github.io/tags/aria2/">aria2</a>
    
    <a href="https://anTtutu.github.io/tags/arm64/">arm64</a>
    
    <a href="https://anTtutu.github.io/tags/awr/">awr</a>
    
    <a href="https://anTtutu.github.io/tags/backup/">backup</a>
    
    <a href="https://anTtutu.github.io/tags/blog/">blog</a>
    
    <a href="https://anTtutu.github.io/tags/bug/">bug</a>
    
    <a href="https://anTtutu.github.io/tags/build/">build</a>
    
    <a href="https://anTtutu.github.io/tags/captcha/">captcha</a>
    
    <a href="https://anTtutu.github.io/tags/check/">check</a>
    
    <a href="https://anTtutu.github.io/tags/cluster/">cluster</a>
    
    <a href="https://anTtutu.github.io/tags/cygwin/">cygwin</a>
    
    <a href="https://anTtutu.github.io/tags/dataguard/">dataguard</a>
    
    <a href="https://anTtutu.github.io/tags/deepfacelab/">deepfacelab</a>
    
    <a href="https://anTtutu.github.io/tags/dos/">dos</a>
    
    <a href="https://anTtutu.github.io/tags/eclipse/">eclipse</a>
    
    <a href="https://anTtutu.github.io/tags/explain/">explain</a>
    
    <a href="https://anTtutu.github.io/tags/gcc/">gcc</a>
    
    <a href="https://anTtutu.github.io/tags/gitment/">gitment</a>
    
    <a href="https://anTtutu.github.io/tags/gitpages/">gitpages</a>
    
    <a href="https://anTtutu.github.io/tags/go/">go</a>
    
    <a href="https://anTtutu.github.io/tags/h2/">h2</a>
    
    <a href="https://anTtutu.github.io/tags/h5/">h5</a>
    
    <a href="https://anTtutu.github.io/tags/ha/">ha</a>
    
    <a href="https://anTtutu.github.io/tags/http/">http</a>
    
    <a href="https://anTtutu.github.io/tags/hugo/">hugo</a>
    
    <a href="https://anTtutu.github.io/tags/java/">java</a>
    
    <a href="https://anTtutu.github.io/tags/jekyll/">jekyll</a>
    
    <a href="https://anTtutu.github.io/tags/jrebel/">jrebel</a>
    
    <a href="https://anTtutu.github.io/tags/js/">js</a>
    
    <a href="https://anTtutu.github.io/tags/jsr/">jsr</a>
    
    <a href="https://anTtutu.github.io/tags/kafka/">kafka</a>
    
    <a href="https://anTtutu.github.io/tags/kali/">kali</a>
    
    <a href="https://anTtutu.github.io/tags/kenlm/">kenlm</a>
    
    <a href="https://anTtutu.github.io/tags/linux/">linux</a>
    
    <a href="https://anTtutu.github.io/tags/log4j/">log4j</a>
    
    <a href="https://anTtutu.github.io/tags/mac/">mac</a>
    
    <a href="https://anTtutu.github.io/tags/mine/">mine</a>
    
    <a href="https://anTtutu.github.io/tags/mongodb/">mongodb</a>
    
    <a href="https://anTtutu.github.io/tags/mysql/">mysql</a>
    
    <a href="https://anTtutu.github.io/tags/nginx/">nginx</a>
    
    <a href="https://anTtutu.github.io/tags/oom/">oom</a>
    
    <a href="https://anTtutu.github.io/tags/oracle/">oracle</a>
    
    <a href="https://anTtutu.github.io/tags/orangePi/">orangePi</a>
    
    <a href="https://anTtutu.github.io/tags/python/">python</a>
    
    <a href="https://anTtutu.github.io/tags/rec/">rec</a>
    
    <a href="https://anTtutu.github.io/tags/redis/">redis</a>
    
    <a href="https://anTtutu.github.io/tags/safe/">safe</a>
    
    <a href="https://anTtutu.github.io/tags/shell/">shell</a>
    
    <a href="https://anTtutu.github.io/tags/springboot/">springboot</a>
    
    <a href="https://anTtutu.github.io/tags/sqlmap/">sqlmap</a>
    
    <a href="https://anTtutu.github.io/tags/ssd/">ssd</a>
    
    <a href="https://anTtutu.github.io/tags/tcp/">tcp</a>
    
    <a href="https://anTtutu.github.io/tags/termux/">termux</a>
    
    <a href="https://anTtutu.github.io/tags/union_id/">union_id</a>
    
    <a href="https://anTtutu.github.io/tags/vcs/">vcs</a>
    
    <a href="https://anTtutu.github.io/tags/virus/">virus</a>
    
    <a href="https://anTtutu.github.io/tags/vxvm/">vxvm</a>
    
    <a href="https://anTtutu.github.io/tags/win10/">win10</a>
    
    <a href="https://anTtutu.github.io/tags/xrebel/">xrebel</a>
    
    <a href="https://anTtutu.github.io/tags/ynote/">ynote</a>
    
    <a href="https://anTtutu.github.io/tags/zk/">zk</a>
    
    <a href="https://anTtutu.github.io/tags/zookeeper/">zookeeper</a>
    
    <a href="https://anTtutu.github.io/tags/%E5%AE%B9%E7%81%BE/">容灾</a>
    
</div>
    </section>

    

    <section class="widget">
        <h3 class="widget-title">其它</h3>
        <ul class="widget-list">
            <li><a href="https://anTtutu.github.io/index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>
            </div>
        </div>
    </div>
</body>

</html>