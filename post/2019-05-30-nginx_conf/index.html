<!doctype html>
<html lang="zh-CN">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="referrer" content="no-referrer-when-downgrade">
    

    <title>nginx参数介绍 | Anttu&#39;s Blog</title>
    <meta property="og:title" content="nginx参数介绍 - Anttu&#39;s Blog">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content='2019-05-30T21:46:20&#43;08:00'>
        
        
    <meta property="article:modified_time" content='2019-05-30T21:46:20&#43;08:00'>
        
    <meta name="Keywords" content="golang,go语言,go语言笔记,anttu,java,博客,bash,linux笔记,python笔记,公众号,小程序">
    <meta name="description" content="nginx参数介绍">
        
    <meta name="author" content="Anttu">
    <meta property="og:url" content="https://anTtutu.github.io/post/2019-05-30-nginx_conf/">
    <link rel="shortcut icon" href='/favicon.ico'  type="image/x-icon">

    <link rel="stylesheet" href='/css/normalize.css'>
    <link rel="stylesheet" href='/css/style.css'>
    <script type="text/javascript" src="//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    
    
    
    
    
    
        <link rel="stylesheet" href='/css/asciinema-player.css'>
    
</head>


<body>
    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="https://anTtutu.github.io/">
                        Anttu&#39;s Blog
                    </a>
                
                <p class="description">一位Java开发者，喜欢研究技术，同时也在学习Golang和Python中，对服务器、Linux使用比较熟悉。欢迎添加技术交流QQ群：655158296</p>
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="current" href="https://anTtutu.github.io/">首页</a>
                    
                    <a  href="https://anTtutu.github.io/archives/" title="归档">归档</a>
                    
                    <a  href="https://anTtutu.github.io/tags/" title="分类">分类</a>
                    
                    <a  href="https://anTtutu.github.io/about/" title="关于">关于</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>

    <div id="body">
        <div class="container">
            <div class="col-group">

                <div class="col-8" id="main">
                    
<div class="res-cons">
    <style type="text/css">
    .post-toc {
        position: fixed;
        width: 200px;
        margin-left: -210px;
        padding: 5px 10px;
        font-family: Athelas, STHeiti, Microsoft Yahei, serif;
        font-size: 12px;
        border: 1px solid rgba(0, 0, 0, .07);
        border-radius: 5px;
        background-color: rgba(255, 255, 255, 0.98);
        background-clip: padding-box;
        -webkit-box-shadow: 1px 1px 2px rgba(0, 0, 0, .125);
        box-shadow: 1px 1px 2px rgba(0, 0, 0, .125);
        word-wrap: break-word;
        white-space: nowrap;
        -webkit-box-sizing: border-box;
        box-sizing: border-box;
        z-index: 999;
        cursor: pointer;
        max-height: 70%;
        overflow-y: auto;
        overflow-x: hidden;
    }

    .post-toc .post-toc-title {
        width: 100%;
        margin: 0 auto;
        font-size: 20px;
        font-weight: 400;
        text-transform: uppercase;
        text-align: center;
    }

    .post-toc .post-toc-content {
        font-size: 15px;
    }

    .post-toc .post-toc-content>nav>ul {
        margin: 10px 0;
    }

    .post-toc .post-toc-content ul {
        padding-left: 20px;
        list-style: square;
        margin: 0.5em;
        line-height: 1.8em;
    }

    .post-toc .post-toc-content ul ul {
        padding-left: 15px;
        display: none;
    }

    @media print,
    screen and (max-width:1057px) {
        .post-toc {
            display: none;
        }
    }
</style>
<div class="post-toc" style="position: absolute; top: 188px;">
    <h2 class="post-toc-title">文章目录</h2>
    <div class="post-toc-content">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#前言">前言</a></li>
    <li><a href="#1nginx运行工作进程数量">1、Nginx运行工作进程数量</a></li>
    <li><a href="#2nginx运行cpu亲和力">2、Nginx运行CPU亲和力</a></li>
    <li><a href="#3nginx最大打开文件数">3、Nginx最大打开文件数</a>
      <ul>
        <li><a href="#注">注：</a></li>
      </ul>
    </li>
    <li><a href="#4nginx事件处理模型">4、Nginx事件处理模型</a></li>
    <li><a href="#5开启高效传输模式">5、开启高效传输模式</a></li>
    <li><a href="#6连接超时时间">6、连接超时时间</a></li>
    <li><a href="#7fastcgi-调优">7、fastcgi 调优</a>
      <ul>
        <li><a href="#总结">总结：</a></li>
      </ul>
    </li>
    <li><a href="#8gzip-调优">8、gzip 调优</a></li>
    <li><a href="#9expires-缓存调优">9、expires 缓存调优</a>
      <ul>
        <li><a href="#注-1">注：</a></li>
        <li><a href="#总结-1">总结：</a></li>
      </ul>
    </li>
    <li><a href="#10防盗链">10、防盗链</a>
      <ul>
        <li><a href="#参数可以使如下形式">参数可以使如下形式：</a></li>
      </ul>
    </li>
    <li><a href="#11内核参数优化">11、内核参数优化</a>
      <ul>
        <li><a href="#下面贴一个完整的内核优化设置">下面贴一个完整的内核优化设置：</a></li>
      </ul>
    </li>
    <li><a href="#12关于系统连接数的优化">12、关于系统连接数的优化</a></li>
  </ul>
</nav>
    </div>
</div>
<script type="text/javascript">
    $(document).ready(function () {
        var postToc = $(".post-toc");
        if (postToc.length) {
            var leftPos = $("#main").offset().left;
            if (leftPos < 220) {
                postToc.css({ "width": leftPos - 10, "margin-left": (0 - leftPos) })
            }

            var t = postToc.offset().top - 20,
                a = {
                    start: {
                        position: "absolute",
                        top: t
                    },
                    process: {
                        position: "fixed",
                        top: 20
                    },
                };
            $(window).scroll(function () {
                var e = $(window).scrollTop();
                e < t ? postToc.css(a.start) : postToc.css(a.process)
            })
        }

        if ($("#TableOfContents").children().length < 1) {
            $(".post-toc").remove();
        }
    })
</script>
    <article class="post">
        <header>
            <h1 class="post-title">nginx参数介绍</h1>
        </header>
        <date class="post-meta meta-date">
            2019年5月30日
        </date>
        
        <div class="post-meta">
            <span>|</span>
            
            <span class="meta-category">
                <a href='/categories/nginx' target="_blank">nginx</a>
            </span>
            
        </div>
        
        
        <div class="post-meta">
            <span id="busuanzi_container_page_pv">|<span id="busuanzi_value_page_pv"></span><span>
                    阅读</span></span>
        </div>
        
        
        <div class="clear" style="display: none">
            <div class="toc-article">
                <div class="toc-title">文章目录</div>
            </div>
        </div>
        
        <div class="post-content">
            <h2 id="前言">前言</h2>
<p>nginx的反向代理和当做前端容器使用比较广泛，有一些参数详情搜集整理下</p>
<h2 id="1nginx运行工作进程数量">1、Nginx运行工作进程数量</h2>
<p>Nginx运行工作进程个数一般设置CPU的核心或者核心数x2。<br>
如果不了解cpu的核数，可以top命令之后按1看出来，也可以查看/proc/cpuinfo文件</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>grep ^processor /proc/cpuinfo | wc -l 
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">[</span>root@lx~<span style="color:#000;font-weight:bold">]</span><span style="color:#998;font-style:italic"># vi /usr/local/nginx1.10/conf/nginx.conf</span>
</span></span><span style="display:flex;"><span>worker_processes 4;
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">[</span>root@lx~<span style="color:#000;font-weight:bold">]</span><span style="color:#998;font-style:italic"># /usr/local/nginx1.10/sbin/nginx-s reload</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">[</span>root@lx~<span style="color:#000;font-weight:bold">]</span><span style="color:#998;font-style:italic"># ps -aux | grep nginx |grep -v grep</span>
</span></span><span style="display:flex;"><span>root <span style="color:#099">9834</span> 0.0 0.0 <span style="color:#099">47556</span> <span style="color:#099">1948</span> ?     Ss 22:36 0:00 nginx: master processnginx
</span></span><span style="display:flex;"><span>www <span style="color:#099">10135</span> 0.0 0.0 <span style="color:#099">50088</span> <span style="color:#099">2004</span> ?       S   22:58 0:00 nginx: worker process
</span></span><span style="display:flex;"><span>www <span style="color:#099">10136</span> 0.0 0.0 <span style="color:#099">50088</span> <span style="color:#099">2004</span> ?       S   22:58 0:00 nginx: worker process
</span></span><span style="display:flex;"><span>www <span style="color:#099">10137</span> 0.0 0.0 <span style="color:#099">50088</span> <span style="color:#099">2004</span> ?       S   22:58 0:00 nginx: worker process
</span></span><span style="display:flex;"><span>www <span style="color:#099">10138</span> 0.0 0.0 <span style="color:#099">50088</span> <span style="color:#099">2004</span> ?       S   22:58 0:00 nginx: worker process
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="2nginx运行cpu亲和力">2、Nginx运行CPU亲和力</h2>
<p>比如4核配置：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>worker_processes 4;
</span></span><span style="display:flex;"><span>worker_cpu_affinity <span style="color:#099">0001</span> <span style="color:#099">0010</span> <span style="color:#099">0100</span> <span style="color:#099">1000</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>比如8核配置：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>worker_processes 8;
</span></span><span style="display:flex;"><span>worker_cpu_affinity <span style="color:#099">00000001</span> <span style="color:#099">00000010</span> <span style="color:#099">00000100</span> <span style="color:#099">0000100000010000</span> <span style="color:#099">00100000</span> <span style="color:#099">01000000</span> 10000000;
</span></span></code></pre></td></tr></table>
</div>
</div><p>worker_processes最多开启8个，8个以上性能提升不会再提升了，而且稳定性变得更低，所以8个进程够用了。</p>
<h2 id="3nginx最大打开文件数">3、Nginx最大打开文件数</h2>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>worker_rlimit_nofile 65535;
</span></span></code></pre></td></tr></table>
</div>
</div><p>这个指令是指当一个nginx进程打开的最多文件描述符数目，理论值应该是最多打开文件数（ulimit -n）与nginx进程数相除，但是nginx分配请求并不是那么均匀，所以最好与ulimit -n的值保持一致。</p>
<h3 id="注">注：</h3>
<p>文件资源限制的配置可以在/etc/security/limits.conf设置，针对root/user等各个用户或者*代表所有用户来设置。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>*   soft nofile   <span style="color:#099">65535</span>
</span></span><span style="display:flex;"><span>*   hard nofile   <span style="color:#099">65535</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>用户重新登录生效（ulimit -n）</p>
<h2 id="4nginx事件处理模型">4、Nginx事件处理模型</h2>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>events <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  use epoll;
</span></span><span style="display:flex;"><span>  worker_connections 65535;
</span></span><span style="display:flex;"><span>  multi_accept on;
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>epoll</td>
<td>nginx采用epoll事件模型，处理效率高。</td>
</tr>
<tr>
<td>work_connections</td>
<td>是单个worker进程允许客户端最大连接数，这个数值一般根据服务器性能和内存来制定，实际最大值就是worker进程数乘以work_connections。<br>实际我们填入一个65535，足够了，这些都算并发值，一个网站的并发达到这么大的数量，也算一个大站了！</td>
</tr>
<tr>
<td>multi_accept</td>
<td>告诉nginx收到一个新连接通知后接受尽可能多的连接，默认是on，<br>设置为on后，多个worker按串行方式来处理连接，也就是一个连接只有一个worker被唤醒，其他的处于休眠状态，<br>设置为off后，多个worker按并行方式来处理连接，也就是一个连接会唤醒所有的worker，直到连接分配完毕，没有取得连接的继续休眠。<br>当你的服务器连接数不多时，开启这个参数会让负载有一定的降低，但是当服务器的吞吐量很大时，为了效率，可以关闭这个参数。</td>
</tr>
</tbody>
</table>
<h2 id="5开启高效传输模式">5、开启高效传输模式</h2>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>http <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  include mime.types;
</span></span><span style="display:flex;"><span>  default_type application/octet-stream;
</span></span><span style="display:flex;"><span>  ……
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  sendfile on;
</span></span><span style="display:flex;"><span>  tcp_nopush on;
</span></span><span style="display:flex;"><span>  ……
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Include mime.types</td>
<td>媒体类型,include 只是一个在当前文件中包含另一个文件内容的指令。</td>
</tr>
<tr>
<td>default_type application/octet-stream</td>
<td>默认媒体类型足够。</td>
</tr>
<tr>
<td>sendfile on</td>
<td>开启高效文件传输模式，sendfile指令指定nginx是否调用sendfile函数来输出文件，<br>对于普通应用设为 on，如果用来进行下载等应用磁盘IO重负载应用，<br>可设置为off，以平衡磁盘与网络I/O处理速度，降低系统的负载。<br>注意：如果图片显示不正常把这个改成off。</td>
</tr>
<tr>
<td>tcp_nopush on</td>
<td>必须在sendfile开启模式才有效，防止网路阻塞，积极的减少网络报文段的数量（将响应头和正文的开始部分一起发送，而不一个接一个的发送。）</td>
</tr>
</tbody>
</table>
<h2 id="6连接超时时间">6、连接超时时间</h2>
<p>主要目的是保护服务器资源，CPU，内存，控制连接数，因为建立连接也是需要消耗资源的。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>keepalive_timeout 60;
</span></span><span style="display:flex;"><span>tcp_nodelay on;
</span></span><span style="display:flex;"><span>client_header_buffer_size 4k;
</span></span><span style="display:flex;"><span>open_file_cache <span style="color:#008080">max</span><span style="color:#000;font-weight:bold">=</span><span style="color:#099">102400</span> <span style="color:#008080">inactive</span><span style="color:#000;font-weight:bold">=</span>20s;
</span></span><span style="display:flex;"><span>open_file_cache_valid 30s;
</span></span><span style="display:flex;"><span>open_file_cache_min_uses 1;
</span></span><span style="display:flex;"><span>client_header_timeout 15;
</span></span><span style="display:flex;"><span>client_body_timeout 15;
</span></span><span style="display:flex;"><span>reset_timedout_connection on;
</span></span><span style="display:flex;"><span>send_timeout 15;
</span></span><span style="display:flex;"><span>server_tokens off;
</span></span><span style="display:flex;"><span>client_max_body_size 10m;
</span></span></code></pre></td></tr></table>
</div>
</div><table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>keepalived_timeout</td>
<td>客户端连接保持会话超时时间，超过这个时间，服务器断开这个链接。</td>
</tr>
<tr>
<td>tcp_nodelay</td>
<td>也是防止网络阻塞，不过要包涵在keepalived参数才有效。</td>
</tr>
<tr>
<td>client_header_buffer_size 4k</td>
<td>客户端请求头部的缓冲区大小，这个可以根据你的系统分页大小来设置，一般一个请求头的大小不会超过 1k，不过由于一般系统分页都要大于1k，所以这里设置为分页大小。分页大小可以用命令getconf PAGESIZE取得。</td>
</tr>
<tr>
<td>open_file_cache max=102400 inactive=20s</td>
<td>这个将为打开文件指定缓存，默认是没有启用的，<br>max指定缓存数量，建议和打开文件数一致，<br>inactive 是指经过多长时间文件没被请求后删除缓存。</td>
</tr>
<tr>
<td>open_file_cache_valid 30s</td>
<td>这个是指多长时间检查一次缓存的有效信息。</td>
</tr>
<tr>
<td>open_file_cache_min_uses 1</td>
<td>open_file_cache指令中的inactive 参数时间内文件的最少使用次数，如果超过这个数字，文件描述符一直是在缓存中打开的，如上例，如果有一个文件在inactive 时间内一次没被使用，它将被移除。</td>
</tr>
<tr>
<td>client_header_timeout</td>
<td>设置请求头的超时时间。我们也可以把这个设置低些，如果超过这个时间没有发送任何数据，nginx将返回request time out的错误。</td>
</tr>
<tr>
<td>client_body_timeout</td>
<td>设置请求体的超时时间。我们也可以把这个设置低些，超过这个时间没有发送任何数据，和上面一样的错误提示。</td>
</tr>
<tr>
<td>reset_timeout_connection</td>
<td>告诉nginx关闭不响应的客户端连接。这将会释放那个客户端所占有的内存空间。</td>
</tr>
<tr>
<td>send_timeout</td>
<td>响应客户端超时时间，这个超时时间仅限于两个活动之间的时间，如果超过这个时间，客户端没有任何活动，nginx关闭连接。</td>
</tr>
<tr>
<td>server_tokens</td>
<td>并不会让nginx执行的速度更快，但它可以关闭在错误页面中的nginx版本数字，这样对于安全性是有好处的。</td>
</tr>
<tr>
<td>client_max_body_size</td>
<td>上传文件大小限制。</td>
</tr>
</tbody>
</table>
<h2 id="7fastcgi-调优">7、fastcgi 调优</h2>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>fastcgi_connect_timeout 600;
</span></span><span style="display:flex;"><span>fastcgi_send_timeout 600;
</span></span><span style="display:flex;"><span>fastcgi_read_timeout 600;
</span></span><span style="display:flex;"><span>fastcgi_buffer_size 64k;
</span></span><span style="display:flex;"><span>fastcgi_buffers <span style="color:#099">4</span> 64k;
</span></span><span style="display:flex;"><span>fastcgi_busy_buffers_size 128k;
</span></span><span style="display:flex;"><span>fastcgi_temp_file_write_size 128k;
</span></span><span style="display:flex;"><span>fastcgi_temp_path/usr/local/nginx1.10/nginx_tmp;
</span></span><span style="display:flex;"><span>fastcgi_intercept_errors on;
</span></span><span style="display:flex;"><span>fastcgi_cache_path/usr/local/nginx1.10/fastcgi_cache <span style="color:#008080">levels</span><span style="color:#000;font-weight:bold">=</span>1:2 <span style="color:#008080">keys_zone</span><span style="color:#000;font-weight:bold">=</span>cache_fastcgi:128minactive<span style="color:#000;font-weight:bold">=</span>1d <span style="color:#008080">max_size</span><span style="color:#000;font-weight:bold">=</span>10g;
</span></span></code></pre></td></tr></table>
</div>
</div><table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>fastcgi_connect_timeout 600</td>
<td>指定连接到后端FastCGI的超时时间。</td>
</tr>
<tr>
<td>fastcgi_send_timeout 600</td>
<td>向FastCGI传送请求的超时时间。</td>
</tr>
<tr>
<td>fastcgi_read_timeout 600</td>
<td>指定接收FastCGI应答的超时时间。</td>
</tr>
<tr>
<td>fastcgi_buffer_size 64k</td>
<td>指定读取FastCGI应答第一部分需要用多大的缓冲区，默认的缓冲区大小为。<br>fastcgi_buffers指令中的每块大小，可以将这个值设置更小。</td>
</tr>
<tr>
<td>fastcgi_buffers 4 64k</td>
<td>指定本地需要用多少和多大的缓冲区来缓冲FastCGI的应答请求，如果一个php脚本所产生的页面大小为256KB，那么会分配4个64KB的缓冲区来缓存，如果页面大小大于256KB，那么大于256KB的部分会缓存到fastcgi_temp_path指定的路径中，但是这并不是好方法，因为内存中的数据处理速度要快于磁盘。一般这个值应该为站点中php脚本所产生的页面大小的中间值，如果站点大部分脚本所产生的页面大小为256KB，那么可以把这个值设置为“8 32K”、“4 64k”等。</td>
</tr>
<tr>
<td>fastcgi_busy_buffers_size 128k</td>
<td>建议设置为fastcgi_buffers的两倍，繁忙时候的buffer。</td>
</tr>
<tr>
<td>fastcgi_temp_file_write_size 128k</td>
<td>在写入fastcgi_temp_path时将用多大的数据块，默认值是fastcgi_buffers的两倍，该数值设置小时若负载上来时可能报502BadGateway。</td>
</tr>
<tr>
<td>fastcgi_temp_path</td>
<td>缓存临时目录。</td>
</tr>
<tr>
<td>fastcgi_intercept_errors on</td>
<td>这个指令指定是否传递4xx和5xx错误信息到客户端，或者允许nginx使用error_page处理错误信息。注：静态文件不存在会返回404页面，但是php页面则返回空白页！</td>
</tr>
<tr>
<td>fastcgi_cache_path /usr/local/nginx1.10/fastcgi_cachelevels=1:2 keys_zone=cache_fastcgi:128minactive=1d max_size=10g</td>
<td>fastcgi_cache缓存目录，可以设置目录层级，比如1:2会生成16*256个子目录，cache_fastcgi是这个缓存空间的名字，cache是用多少内存（这样热门的内容nginx直接放内存，提高访问速度），inactive表示默认失效时间，如果缓存数据在失效时间内没有被访问,将被删除，max_size表示最多用多少硬盘空间。</td>
</tr>
<tr>
<td>fastcgi_cache cache_fastcgi</td>
<td>表示开启FastCGI缓存并为其指定一个名称。开启缓存非常有用，可以有效降低CPU的负载，并且防止502的错误放生。cache_fastcgi为proxy_cache_path指令创建的缓存区名称。</td>
</tr>
<tr>
<td>fastcgi_cache_valid 200 302 1h</td>
<td>用来指定应答代码的缓存时间，实例中的值表示将200和302应答缓存一小时，要和fastcgi_cache配合使用。</td>
</tr>
<tr>
<td>fastcgi_cache_valid 301 1d</td>
<td>将301应答缓存一天。</td>
</tr>
<tr>
<td>fastcgi_cache_valid any 1m</td>
<td>将其他应答缓存为1分钟。</td>
</tr>
<tr>
<td>fastcgi_cache_min_uses 1</td>
<td>该指令用于设置经过多少次请求的相同URL将被缓存。</td>
</tr>
<tr>
<td>fastcgi_cache_key http://$host$request_uri</td>
<td>该指令用来设置web缓存的Key值,nginx根据Key值md5哈希存储.一般根据$host(域名)、$request_uri(请求的路径)等变量组合成proxy_cache_key 。</td>
</tr>
<tr>
<td>fastcgi_pass</td>
<td>指定FastCGI服务器监听端口与地址，可以是本机或者其它。</td>
</tr>
</tbody>
</table>
<h3 id="总结">总结：</h3>
<p>nginx的缓存功能有：proxy_cache / fastcgi_cache<br>
proxy_cache的作用是缓存后端服务器的内容，可能是任何内容，包括静态的和动态。<br>
fastcgi_cache的作用是缓存fastcgi生成的内容，很多情况是php生成的动态的内容。<br>
proxy_cache缓存减少了nginx与后端通信的次数，节省了传输时间和后端宽带。<br>
fastcgi_cache缓存减少了nginx与php的通信的次数，更减轻了php和数据库(mysql)的压力。</p>
<h2 id="8gzip-调优">8、gzip 调优</h2>
<p>使用gzip压缩功能，可能为我们节约带宽，加快传输速度，有更好的体验，也为我们节约成本，所以说这是一个重点。<br>
Nginx启用压缩功能需要你来ngx_http_gzip_module模块，apache使用的是mod_deflate。<br>
一般我们需要压缩的内容有：文本，js，html，css，对于图片，视频，flash什么的不压缩，同时也要注意，我们使用gzip的功能是需要消耗CPU的！</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gzip on;
</span></span><span style="display:flex;"><span>gzip_min_length 2k;
</span></span><span style="display:flex;"><span>gzip_buffers   <span style="color:#099">4</span> 32k;
</span></span><span style="display:flex;"><span>gzip_http_version 1.1;
</span></span><span style="display:flex;"><span>gzip_comp_level 6;
</span></span><span style="display:flex;"><span>gzip_typestext/plain text/css text/javascriptapplication/json application/javascript application/x-javascriptapplication/xml;
</span></span><span style="display:flex;"><span>gzip_vary on;
</span></span><span style="display:flex;"><span>gzip_proxied any;
</span></span></code></pre></td></tr></table>
</div>
</div><table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>gzip on;</td>
<td>开启压缩功能</td>
</tr>
<tr>
<td>gzip_min_length 1k</td>
<td>设置允许压缩的页面最小字节数，页面字节数从header头的Content-Length中获取，默认值是0，不管页面多大都进行压缩，建议设置成大于1K，如果小与1K可能会越压越大。</td>
</tr>
<tr>
<td>gzip_buffers 4 32k</td>
<td>压缩缓冲区大小，表示申请4个单位为32K的内存作为压缩结果流缓存，默认值是申请与原始数据大小相同的内存空间来存储gzip压缩结果。</td>
</tr>
<tr>
<td>gzip_http_version 1.1</td>
<td>压缩版本，用于设置识别HTTP协议版本，默认是1.1，目前大部分浏览器已经支持GZIP解压，使用默认即可。</td>
</tr>
<tr>
<td>gzip_comp_level 6</td>
<td>压缩比例，用来指定GZIP压缩比，1压缩比最小，处理速度最快，9压缩比最大，传输速度快，但是处理慢，也比较消耗CPU资源。</td>
</tr>
<tr>
<td>gzip_types text/css text/xml application/javascript</td>
<td>用来指定压缩的类型，‘text/html’类型总是会被压缩。<br>默认值: gzip_types text/html (默认不对js/css文件进行压缩) 压缩类型，匹配MIME型进行压缩；<br>不能用通配符 text/*；<br>text/html默认已经压缩 (无论是否指定)；<br>设置哪压缩种文本文件可参考 conf/mime.types。</td>
</tr>
<tr>
<td>gzip_vary on</td>
<td>varyheader支持，改选项可以让前端的缓存服务器缓存经过GZIP压缩的页面，例如用Squid缓存经过nginx压缩的数据。</td>
</tr>
</tbody>
</table>
<h2 id="9expires-缓存调优">9、expires 缓存调优</h2>
<p>缓存，主要针对于图片，css，js等元素更改机会比较少的情况下使用，特别是图片，占用带宽大，我们完全可以设置图片在浏览器本地缓存365d，css，js，html可以缓存个10来天，这样用户第一次打开加载慢一点，第二次，就非常快了！缓存的时候，我们需要将需要缓存的拓展名列出来， Expires缓存配置在server字段里面。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>location ~* <span style="color:#d14">\.</span><span style="color:#000;font-weight:bold">(</span>ico|jpe?g|gif|png|bmp|swf|flv<span style="color:#000;font-weight:bold">)</span>$ <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>expires 30d;
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#log_not_found off;</span>
</span></span><span style="display:flex;"><span>access_log off;
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>location ~* <span style="color:#d14">\.</span><span style="color:#000;font-weight:bold">(</span>js|css<span style="color:#000;font-weight:bold">)</span>$ <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>expires 7d;
</span></span><span style="display:flex;"><span>log_not_found off;
</span></span><span style="display:flex;"><span>access_log off;
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="注-1">注：</h3>
<p>log_not_found off;是否在error_log中记录不存在的错误。默认是。</p>
<h3 id="总结-1">总结：</h3>
<h4 id="expire功能优点">expire功能优点：</h4>
<p>expires可以降低网站购买的带宽，节约成本；<br>
同时提升用户访问体验；<br>
减轻服务的压力，节约服务器成本，是web服务非常重要的功能。</p>
<h4 id="expire功能缺点">expire功能缺点：</h4>
<p>被缓存的页面或数据更新了，用户看到的可能还是旧的内容，反而影响用户体验。<br>
解决办法：第一个缩短缓存时间，例如：1天，但不彻底，除非更新频率大于1天；第二个对缓存的对象改名。</p>
<h4 id="网站不希望被缓存的内容">网站不希望被缓存的内容：</h4>
<p>网站流量统计工具；<br>
更新频繁的文件（google的logo）。</p>
<h2 id="10防盗链">10、防盗链</h2>
<p>防止别人直接从你网站引用图片等链接，消耗了你的资源和网络流量，那么我们的解决办法由几种：<br>
水印，品牌宣传，你的带宽，服务器足够；<br>
防火墙，直接控制，前提是你知道IP来源；<br>
防盗链策略下面的方法是直接给予404的错误提示。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>location ~*^.+<span style="color:#d14">\.</span><span style="color:#000;font-weight:bold">(</span>jpg|gif|png|swf|flv|wma|wmv|asf|mp3|mmf|zip|rar<span style="color:#000;font-weight:bold">)</span>$ <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>valid_referers noneblocked www.benet.com benet.com;
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span><span style="color:#008080">$invalid_referer</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">#return 302 http://www.benet.com/img/nolink.jpg;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">return</span> 404;
</span></span><span style="display:flex;"><span>  break;
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>access_log off;
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="参数可以使如下形式">参数可以使如下形式：</h3>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>none</td>
<td>意思是不存在的Referer头(表示空的，也就是直接访问，比如直接在浏览器打开一个图片)。</td>
</tr>
<tr>
<td>blocked</td>
<td>意为根据防火墙伪装Referer头，如：“Referer:XXXXXXX”。</td>
</tr>
<tr>
<td>server_names</td>
<td>为一个或多个服务器的列表，0.5.33版本以后可以在名称中使用“*”通配符。</td>
</tr>
</tbody>
</table>
<h2 id="11内核参数优化">11、内核参数优化</h2>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>fs.file-max = 999999</td>
<td>这个参数表示进程（比如一个worker进程）可以同时打开的最大句柄数，这个参数直线限制最大并发连接数，需根据实际情况配置。</td>
</tr>
<tr>
<td>net.ipv4.tcp_max_tw_buckets = 6000</td>
<td>这个参数表示操作系统允许TIME_WAIT套接字数量的最大值，如果超过这个数字，TIME_WAIT套接字将立刻被清除并打印警告信息。该参数默认为180000，过多的TIME_WAIT套接字会使Web服务器变慢。注：主动关闭连接的服务端会产生TIME_WAIT状态的连接</td>
</tr>
<tr>
<td>net.ipv4.ip_local_port_range = 1024 65000</td>
<td>允许系统打开的端口范围。</td>
</tr>
<tr>
<td>net.ipv4.tcp_tw_recycle = 1</td>
<td>启用timewait快速回收。</td>
</tr>
<tr>
<td>net.ipv4.tcp_tw_reuse = 1</td>
<td>开启重用。允许将TIME-WAIT sockets重新用于新的TCP连接。这对于服务器来说很有意义，因为服务器上总会有大量TIME-WAIT状态的连接。</td>
</tr>
<tr>
<td>net.ipv4.tcp_keepalive_time = 30</td>
<td>这个参数表示当keepalive启用时，TCP发送keepalive消息的频度。默认是2小时，若将其设置的小一些，可以更快地清理无效的连接。</td>
</tr>
<tr>
<td>net.ipv4.tcp_syncookies = 1</td>
<td>开启SYN Cookies，当出现SYN等待队列溢出时，启用cookies来处理。</td>
</tr>
<tr>
<td>net.core.somaxconn = 40960</td>
<td>web 应用中 listen 函数的 backlog 默认会给我们内核参数的。</td>
</tr>
<tr>
<td>net.core.somaxconn</td>
<td>限制到128，而nginx定义的NGX_LISTEN_BACKLOG 默认为511，所以有必要调整这个值。注：对于一个TCP连接，Server与Client需要通过三次握手来建立网络连接.当三次握手成功后,我们可以看到端口的状态由LISTEN转变为ESTABLISHED,接着这条链路上就可以开始传送数据了.每一个处于监听(Listen)状态的端口,都有自己的监听队列.监听队列的长度与如somaxconn参数和使用该端口的程序中listen()函数有关。somaxconn定义了系统中每一个端口最大的监听队列的长度,这是个全局的参数,默认值为128，对于一个经常处理新连接的高负载 web服务环境来说，默认的 128 太小了。大多数环境这个值建议增加到 1024 或者更多。大的侦听队列对防止拒绝服务 DoS 攻击也会有所帮助。</td>
</tr>
<tr>
<td>net.core.netdev_max_backlog = 262144</td>
<td>每个网络接口接收数据包的速率比内核处理这些包的速率快时，允许送到队列的数据包的最大数目。</td>
</tr>
<tr>
<td>net.ipv4.tcp_max_syn_backlog = 262144</td>
<td>这个参数标示TCP三次握手建立阶段接受SYN请求队列的最大长度，默认为1024，将其设置得大一些可以使出现Nginx繁忙来不及accept新连接的情况时，Linux不至于丢失客户端发起的连接请求。</td>
</tr>
<tr>
<td>net.ipv4.tcp_rmem = 10240 87380 12582912</td>
<td>这个参数定义了TCP接受缓存（用于TCP接受滑动窗口）的最小值、默认值、最大值。</td>
</tr>
<tr>
<td>net.ipv4.tcp_wmem = 10240 87380 12582912</td>
<td>这个参数定义了TCP发送缓存（用于TCP发送滑动窗口）的最小值、默认值、最大值。</td>
</tr>
<tr>
<td>net.core.rmem_default = 6291456</td>
<td>这个参数表示内核套接字接受缓存区默认的大小。</td>
</tr>
<tr>
<td>net.core.wmem_default = 6291456</td>
<td>这个参数表示内核套接字发送缓存区默认的大小。</td>
</tr>
<tr>
<td>net.core.rmem_max = 12582912</td>
<td>这个参数表示内核套接字接受缓存区的最大大小。</td>
</tr>
<tr>
<td>net.core.wmem_max = 12582912</td>
<td>这个参数表示内核套接字发送缓存区的最大大小。</td>
</tr>
<tr>
<td>net.ipv4.tcp_syncookies = 1</td>
<td>该参数与性能无关，用于解决TCP的SYN攻击。</td>
</tr>
</tbody>
</table>
<h3 id="下面贴一个完整的内核优化设置">下面贴一个完整的内核优化设置：</h3>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>fs.file-max <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">999999</span>
</span></span><span style="display:flex;"><span>net.ipv4.ip_forward <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>
</span></span><span style="display:flex;"><span>net.ipv4.conf.default.rp_filter <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>net.ipv4.conf.default.accept_source_route <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>
</span></span><span style="display:flex;"><span>kernel.sysrq <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>
</span></span><span style="display:flex;"><span>kernel.core_uses_pid <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>net.ipv4.tcp_syncookies <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>kernel.msgmnb <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">65536</span>
</span></span><span style="display:flex;"><span>kernel.msgmax <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">65536</span>
</span></span><span style="display:flex;"><span>kernel.shmmax <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">68719476736</span>
</span></span><span style="display:flex;"><span>kernel.shmall <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">4294967296</span>
</span></span><span style="display:flex;"><span>net.ipv4.tcp_max_tw_buckets <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">6000</span>
</span></span><span style="display:flex;"><span>net.ipv4.tcp_sack <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>net.ipv4.tcp_window_scaling <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>net.ipv4.tcp_rmem <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">10240</span> <span style="color:#099">87380</span> <span style="color:#099">12582912</span>
</span></span><span style="display:flex;"><span>net.ipv4.tcp_wmem <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">10240</span> <span style="color:#099">87380</span> <span style="color:#099">12582912</span>
</span></span><span style="display:flex;"><span>net.core.wmem_default <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">8388608</span>
</span></span><span style="display:flex;"><span>net.core.rmem_default <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">8388608</span>
</span></span><span style="display:flex;"><span>net.core.rmem_max <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">16777216</span>
</span></span><span style="display:flex;"><span>net.core.wmem_max <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">16777216</span>
</span></span><span style="display:flex;"><span>net.core.netdev_max_backlog <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">262144</span>
</span></span><span style="display:flex;"><span>net.core.somaxconn <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">40960</span>
</span></span><span style="display:flex;"><span>net.ipv4.tcp_max_orphans <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">3276800</span>
</span></span><span style="display:flex;"><span>net.ipv4.tcp_max_syn_backlog <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">262144</span>
</span></span><span style="display:flex;"><span>net.ipv4.tcp_timestamps <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>
</span></span><span style="display:flex;"><span>net.ipv4.tcp_synack_retries <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>net.ipv4.tcp_syn_retries <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>net.ipv4.tcp_tw_recycle <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>net.ipv4.tcp_tw_reuse <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>net.ipv4.tcp_mem <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">94500000</span> <span style="color:#099">915000000</span> <span style="color:#099">927000000</span>
</span></span><span style="display:flex;"><span>net.ipv4.tcp_fin_timeout <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>net.ipv4.tcp_keepalive_time <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">30</span>
</span></span><span style="display:flex;"><span>net.ipv4.ip_local_port_range <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1024</span> <span style="color:#099">65000</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>执行sysctl  -p使内核修改生效。</p>
<h2 id="12关于系统连接数的优化">12、关于系统连接数的优化</h2>
<p>linux 默认值 open files为1024。查看当前系统值：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># ulimit -n</span>
</span></span><span style="display:flex;"><span><span style="color:#099">1024</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>说明server只允许同时打开1024个文件。<br>
使用ulimit -a 可以查看当前系统的所有限制值，使用ulimit -n 可以查看当前的最大打开文件数。<br>
新装的linux 默认只有1024 ，当作负载较大的服务器时，很容易遇到error: too many open files。<br>
因此，需要将其改大，在/etc/security/limits.conf最后增加：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>*               soft    nofile         <span style="color:#099">65535</span>
</span></span><span style="display:flex;"><span>*               hard    nofile         <span style="color:#099">65535</span>
</span></span><span style="display:flex;"><span>*               soft    noproc         <span style="color:#099">65535</span>
</span></span><span style="display:flex;"><span>*               hard    noproc         <span style="color:#099">65535</span>
</span></span></code></pre></td></tr></table>
</div>
</div>
        </div>

        
<div class="post-archive">
    <ul class="post-copyright">
        <li><strong>原文作者：</strong><a rel="author" href="https://anTtutu.github.io/">Anttu</a></li>
        <li style="word-break:break-all"><strong>原文链接：</strong><a href="https://anTtutu.github.io/post/2019-05-30-nginx_conf/">https://anTtutu.github.io/post/2019-05-30-nginx_conf/</a></li>
        <li><strong>版权声明：</strong>本作品采用<a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/">知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议</a>进行许可，非商业转载请注明出处（作者，原文链接），商业转载请联系作者获得授权。</li>
    </ul>
</div>
<br/>



        

<div class="post-archive">
    <h2>See Also</h2>
    <ul class="listing">
        
        <li><a href="/post/2019-04-21-linux_knoledge/">linux的一些细节点-不定期补充</a></li>
        
        <li><a href="/post/2019-03-26-mysql_data_restore/">被同事误删表找回丢失的数据</a></li>
        
        <li><a href="/post/2019-03-11-jdkbug/">JDK1.8.0.161版本bug定位</a></li>
        
        <li><a href="/post/2018-12-04-disaster_recovery/">容灾概念介绍</a></li>
        
        <li><a href="/post/2018-11-08-vconsole/">手机端调测H5页面神器-vConsole</a></li>
        
    </ul>
</div>


        <div class="post-meta meta-tags">
            
            <ul class="clearfix">
                
                <li><a href='/tags/nginx' target="_blank">nginx</a></li>
                
            </ul>
            
        </div>
    </article>
    
    

    
    
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "anTtutu/anTtutu.github.io"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
      </script>
    </div>
    
    
    
</div>

                    <footer id="footer">
    <div>
        &copy; 2022 <a href="https://anTtutu.github.io/">Anttu&#39;s Blog By Anttu</a>
        
    </div>
    <br />
    <div>
        <div class="github-badge">
            <a href="https://gohugo.io/" target="_black" rel="nofollow"><span class="badge-subject">Powered by</span><span class="badge-value bg-blue">Hugo</span></a>
        </div>
        
        <div class="github-badge">
            <a href="https://github.com/flysnow-org/maupassant-hugo" target="_black"><span class="badge-subject">Theme</span><span class="badge-value bg-yellowgreen">Maupassant</span></a>
        </div>
    </div>
</footer>


    
    
    <script type="text/javascript">
        window.MathJax = {
            tex2jax: {
                inlineMath: [['$', '$']],
                processEscapes: true
                }
            };
    </script>
    <script src='//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src='/js/totop.js?v=0.0.0' async=""></script>
<style type="text/css">
div.highlight {
    position: relative;
    margin: 1em 0px;
}

.copy-code {
    display: none;
    position: absolute;
    top: 4px;
    right: 4px;
    color: rgba(255, 255, 255, 0.8);
    background: rgba(78, 78, 78, 0.8);
    border-radius: var(--radius);
    padding: 0 5px;
    font: inherit;
    user-select: none;
    cursor: pointer;
    border: 0;
    --radius: 8px;
}

div.highlight:hover .copy-code,pre:hover .copy-code {
    display: block;
}

</style>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>


    <script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>




    <script src='/js/asciinema-player.js'></script>

                </div>

                <div id="secondary">
    <section class="widget">
        <form id="search" action='https://anTtutu.github.io/search' method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="https://anTtutu.github.io/">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>
    
    <section class="widget">
        <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    
    <li>
        <a href="https://anTtutu.github.io/post/2022-09-27-docker_network/" title="docker网络模式" target="_blank">docker网络模式</a>
    </li>
    
    <li>
        <a href="https://anTtutu.github.io/post/2022-11-10-go_muilt_version/" title="go多版本管理工具" target="_blank">go多版本管理工具</a>
    </li>
    
    <li>
        <a href="https://anTtutu.github.io/post/2022-10-27-jenkins_reset/" title="jenkins的admin密码忘记了如何重置" target="_blank">jenkins的admin密码忘记了如何重置</a>
    </li>
    
    <li>
        <a href="https://anTtutu.github.io/post/2022-09-13-dockerfile/" title="dockerfile学习" target="_blank">dockerfile学习</a>
    </li>
    
    <li>
        <a href="https://anTtutu.github.io/post/2022-09-06-mac_docker_dev/" title="Mac配置docker开发工具" target="_blank">Mac配置docker开发工具</a>
    </li>
    
    <li>
        <a href="https://anTtutu.github.io/post/2022-08-11-arthas/" title="转载-arthas常见用法" target="_blank">转载-arthas常见用法</a>
    </li>
    
    <li>
        <a href="https://anTtutu.github.io/post/2022-07-11-id_discuss/" title="几种id浅谈" target="_blank">几种id浅谈</a>
    </li>
    
    <li>
        <a href="https://anTtutu.github.io/post/2022-06-17-python_req/" title="python打包-只依赖自己项目引用的module" target="_blank">python打包-只依赖自己项目引用的module</a>
    </li>
    
    <li>
        <a href="https://anTtutu.github.io/post/2022-05-25-pen_testing/" title="渗透测试的部分资料" target="_blank">渗透测试的部分资料</a>
    </li>
    
    <li>
        <a href="https://anTtutu.github.io/post/2022-04-22-shell_question/" title="转载-shell 13问" target="_blank">转载-shell 13问</a>
    </li>
    
</ul>
    </section>

    

    <section class="widget">
        <h3 class="widget-title"><a href='/categories/'>分类</a></h3>
<ul class="widget-list">
    
    <li><a href="https://anTtutu.github.io/categories/about/">about (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/android/">android (2)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/app/">app (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/aria2/">aria2 (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/arm64/">arm64 (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/arthas/">arthas (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/awr/">awr (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/backend_execute/">backend_execute (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/backup/">backup (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/blog/">blog (3)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/bug/">bug (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/build/">build (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/cache/">cache (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/caffeine/">caffeine (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/captcha/">captcha (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/check/">check (4)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/clean/">clean (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/cli/">cli (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/cluster/">cluster (4)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/cve/">cve (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/cygwin/">cygwin (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/dataguard/">dataguard (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/deepfacelab/">deepfacelab (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/devops/">devops (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/docker/">docker (4)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/dockerfile/">dockerfile (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/dos/">dos (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/dump/">dump (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/eclipse/">eclipse (2)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/explain/">explain (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/faker/">faker (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/gcc/">gcc (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/git/">git (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/gitment/">gitment (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/gitpages/">gitpages (2)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/go/">go (5)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/h2/">h2 (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/h5/">h5 (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/ha/">ha (4)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/http/">http (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/hugo/">hugo (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/id/">id (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/java/">java (24)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/jekyll/">jekyll (2)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/jenkins/">jenkins (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/jrebel/">jrebel (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/js/">js (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/jsr/">jsr (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/jvm/">jvm (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/kafka/">kafka (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/kali/">kali (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/kenlm/">kenlm (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/linux/">linux (20)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/log/">log (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/log4j/">log4j (2)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/lombok/">lombok (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/mac/">mac (5)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/matplotlib/">matplotlib (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/maven/">maven (2)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/mine/">mine (4)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/mongodb/">mongodb (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/mysql/">mysql (5)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/nginx/">nginx (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/nmap/">nmap (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/oom/">oom (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/oracle/">oracle (3)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/orangePi/">orangePi (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/package/">package (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/pandas/">pandas (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/port/">port (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/python/">python (7)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/rec/">rec (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/redis/">redis (3)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/regexp/">regexp (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/safe/">safe (5)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/sdkman/">sdkman (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/shell/">shell (3)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/split/">split (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/springboot/">springboot (3)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/springcloud/">springcloud (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/sqlmap/">sqlmap (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/ssd/">ssd (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/tcp/">tcp (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/termux/">termux (2)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/test/">test (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/testing/">testing (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/union_id/">union_id (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/vcs/">vcs (7)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/virus/">virus (4)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/vxvm/">vxvm (3)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/win10/">win10 (6)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/xrebel/">xrebel (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/ynote/">ynote (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/zk/">zk (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/zookeeper/">zookeeper (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/%E5%89%8D%E7%AB%AF/">前端 (1)</a></li>
    
    <li><a href="https://anTtutu.github.io/categories/%E5%AE%B9%E7%81%BE/">容灾 (1)</a></li>
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title"><a href='/tags/'>标签</a></h3>
<div class="tagcloud">
    
    <a href="https://anTtutu.github.io/tags/about/">about</a>
    
    <a href="https://anTtutu.github.io/tags/android/">android</a>
    
    <a href="https://anTtutu.github.io/tags/app/">app</a>
    
    <a href="https://anTtutu.github.io/tags/aria2/">aria2</a>
    
    <a href="https://anTtutu.github.io/tags/arm64/">arm64</a>
    
    <a href="https://anTtutu.github.io/tags/awr/">awr</a>
    
    <a href="https://anTtutu.github.io/tags/backup/">backup</a>
    
    <a href="https://anTtutu.github.io/tags/blog/">blog</a>
    
    <a href="https://anTtutu.github.io/tags/bug/">bug</a>
    
    <a href="https://anTtutu.github.io/tags/build/">build</a>
    
    <a href="https://anTtutu.github.io/tags/captcha/">captcha</a>
    
    <a href="https://anTtutu.github.io/tags/check/">check</a>
    
    <a href="https://anTtutu.github.io/tags/cluster/">cluster</a>
    
    <a href="https://anTtutu.github.io/tags/cygwin/">cygwin</a>
    
    <a href="https://anTtutu.github.io/tags/dataguard/">dataguard</a>
    
    <a href="https://anTtutu.github.io/tags/deepfacelab/">deepfacelab</a>
    
    <a href="https://anTtutu.github.io/tags/dos/">dos</a>
    
    <a href="https://anTtutu.github.io/tags/eclipse/">eclipse</a>
    
    <a href="https://anTtutu.github.io/tags/explain/">explain</a>
    
    <a href="https://anTtutu.github.io/tags/gcc/">gcc</a>
    
    <a href="https://anTtutu.github.io/tags/gitment/">gitment</a>
    
    <a href="https://anTtutu.github.io/tags/gitpages/">gitpages</a>
    
    <a href="https://anTtutu.github.io/tags/go/">go</a>
    
    <a href="https://anTtutu.github.io/tags/h2/">h2</a>
    
    <a href="https://anTtutu.github.io/tags/h5/">h5</a>
    
    <a href="https://anTtutu.github.io/tags/ha/">ha</a>
    
    <a href="https://anTtutu.github.io/tags/http/">http</a>
    
    <a href="https://anTtutu.github.io/tags/hugo/">hugo</a>
    
    <a href="https://anTtutu.github.io/tags/java/">java</a>
    
    <a href="https://anTtutu.github.io/tags/jekyll/">jekyll</a>
    
    <a href="https://anTtutu.github.io/tags/jrebel/">jrebel</a>
    
    <a href="https://anTtutu.github.io/tags/js/">js</a>
    
    <a href="https://anTtutu.github.io/tags/jsr/">jsr</a>
    
    <a href="https://anTtutu.github.io/tags/kafka/">kafka</a>
    
    <a href="https://anTtutu.github.io/tags/kali/">kali</a>
    
    <a href="https://anTtutu.github.io/tags/kenlm/">kenlm</a>
    
    <a href="https://anTtutu.github.io/tags/linux/">linux</a>
    
    <a href="https://anTtutu.github.io/tags/log4j/">log4j</a>
    
    <a href="https://anTtutu.github.io/tags/mac/">mac</a>
    
    <a href="https://anTtutu.github.io/tags/mine/">mine</a>
    
    <a href="https://anTtutu.github.io/tags/mongodb/">mongodb</a>
    
    <a href="https://anTtutu.github.io/tags/mysql/">mysql</a>
    
    <a href="https://anTtutu.github.io/tags/nginx/">nginx</a>
    
    <a href="https://anTtutu.github.io/tags/oom/">oom</a>
    
    <a href="https://anTtutu.github.io/tags/oracle/">oracle</a>
    
    <a href="https://anTtutu.github.io/tags/orangePi/">orangePi</a>
    
    <a href="https://anTtutu.github.io/tags/python/">python</a>
    
    <a href="https://anTtutu.github.io/tags/rec/">rec</a>
    
    <a href="https://anTtutu.github.io/tags/redis/">redis</a>
    
    <a href="https://anTtutu.github.io/tags/safe/">safe</a>
    
    <a href="https://anTtutu.github.io/tags/shell/">shell</a>
    
    <a href="https://anTtutu.github.io/tags/springboot/">springboot</a>
    
    <a href="https://anTtutu.github.io/tags/sqlmap/">sqlmap</a>
    
    <a href="https://anTtutu.github.io/tags/ssd/">ssd</a>
    
    <a href="https://anTtutu.github.io/tags/tcp/">tcp</a>
    
    <a href="https://anTtutu.github.io/tags/termux/">termux</a>
    
    <a href="https://anTtutu.github.io/tags/union_id/">union_id</a>
    
    <a href="https://anTtutu.github.io/tags/vcs/">vcs</a>
    
    <a href="https://anTtutu.github.io/tags/virus/">virus</a>
    
    <a href="https://anTtutu.github.io/tags/vxvm/">vxvm</a>
    
    <a href="https://anTtutu.github.io/tags/win10/">win10</a>
    
    <a href="https://anTtutu.github.io/tags/xrebel/">xrebel</a>
    
    <a href="https://anTtutu.github.io/tags/ynote/">ynote</a>
    
    <a href="https://anTtutu.github.io/tags/zk/">zk</a>
    
    <a href="https://anTtutu.github.io/tags/zookeeper/">zookeeper</a>
    
    <a href="https://anTtutu.github.io/tags/%E5%AE%B9%E7%81%BE/">容灾</a>
    
</div>
    </section>

    

    <section class="widget">
        <h3 class="widget-title">其它</h3>
        <ul class="widget-list">
            <li><a href="https://anTtutu.github.io/index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>
            </div>
        </div>
    </div>
</body>

</html>